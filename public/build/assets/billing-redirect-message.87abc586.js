import{bW as A,cm as M,r as l,bl as B,u as C,d as N,j as I,a as s,c as D,B as P,ai as o,A as F,l as R,ah as j,c7 as W,T as E,P as z}from"./main.2bad25cd.js";import{T as V}from"./TaskAlt.11c90068.js";var k="https://js.stripe.com/v3",q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,y="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",G=function(){for(var e=document.querySelectorAll('script[src^="'.concat(k,'"]')),t=0;t<e.length;t++){var n=e[t];if(!!q.test(n.src))return n}return null},U=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(k).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},X=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.36.0",startTime:t})},w=null,$=function(e){return w!==null||(w=new Promise(function(t,n){if(typeof window>"u"){t(null);return}if(window.Stripe&&e&&console.warn(y),window.Stripe){t(window.Stripe);return}try{var a=G();a&&e?console.warn(y):a||(a=U(e)),a.addEventListener("load",function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(i){n(i);return}})),w},O=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return X(a,n),a},L=Promise.resolve().then(function(){return $(null)}),T=!1;L.catch(function(r){T||console.warn(r)});var H=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T=!0;var a=Date.now();return L.then(function(i){return O(i,t,a)})};function J({type:r,productId:e}){const{user:t}=A(),n=M(),a=l.exports.useRef(!1),i=l.exports.useRef(null),{localeCode:f}=B(),[u,S]=l.exports.useState(null),[x,h]=l.exports.useState(null),{branding:{site_name:m},billing:{stripe_public_key:c,stripe:{enable:v}}}=C();return l.exports.useEffect(()=>{!v||!c||a.current||(Promise.all([H(c,{apiVersion:"2022-08-01",locale:f}),r==="setupIntent"?K():Q(e)]).then(([d,{clientSecret:b}])=>{if(d&&i.current){const p=d.elements({clientSecret:b,appearance:{theme:n?"night":"stripe"}});p.create("payment",{business:{name:m},terms:{card:"never"},defaultValues:{billingDetails:{email:t==null?void 0:t.email}}}).mount(i.current),S(d),h(p)}}),a.current=!0)},[e,c,v,n,f,m,r,t==null?void 0:t.email]),{stripe:u,elements:x,paymentElementRef:i,stripeIsEnabled:c!=null&&v}}function K(){return N.post("billing/stripe/create-setup-intent").then(r=>r.data)}function Q(r){return N.post("billing/stripe/create-partial-subscription",{product_id:r}).then(e=>e.data)}function re({productId:r,type:e="subscription",submitLabel:t,returnUrl:n}){const{stripe:a,elements:i,paymentElementRef:f,stripeIsEnabled:u}=J({type:e,productId:r}),[S,x]=l.exports.useState(null),[h,m]=l.exports.useState(!1),c=!u||i!=null&&a!=null;return I("form",{onSubmit:async d=>{var b,p;if(d.preventDefault(),!(!a||!i)){m(!0);try{const g=await a[e==="subscription"?"confirmPayment":"confirmSetup"]({elements:i,confirmParams:{return_url:n}});((b=g.error)==null?void 0:b.type)!=="validation_error"&&((p=g.error)==null?void 0:p.message)&&x(g.error.message)}catch{}m(!1)}},children:[s("div",{ref:f,className:D("min-h-[228px]",!u&&"hidden"),children:u&&s(Y,{})}),S&&!h&&s("div",{className:"text-danger mt-20",children:S}),s(P,{variant:"flat",color:"primary",size:"md",className:"w-full mt-40",type:"submit",disabled:h||!c,children:t})]})}function Y(){return I(l.exports.Fragment,{children:[s(o,{className:"h-30 mb-20"}),s(o,{className:"h-30 mb-20"}),s(o,{className:"h-30 mb-20"}),s(o,{className:"h-30"})]})}function ne({config:r}){return s(F,{initial:!1,mode:"wait",children:s("div",{className:"mt-80",children:r?l.exports.createElement(R.div,{className:"text-center md:w-min whitespace-nowrap",...j,key:"payment-status"},r.status==="success"?s(V,{className:"text-positive text-6xl"}):s(W,{className:"text-danger text-6xl"}),s("div",{className:"text-2xl font-semibold mt-30",children:s(E,{...r.message})}),s(P,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:z,to:r.link,children:s(E,{...r.buttonLabel})})):s(Z,{},"loading-skeleton")})})}function Z(){return l.exports.createElement(R.div,{...j,key:"loading-skeleton",className:"text-center max-w-280"},s(o,{size:"w-50 h-50",variant:"rect"}),s(o,{className:"text-2xl mt-30"}),s(o,{size:"h-42",className:"mt-30"}))}export{ne as B,re as S,H as l};
//# sourceMappingURL=billing-redirect-message.87abc586.js.map
