import{bQ as Sr,bR as Nt,bS as kr,bT as Ir,bU as Er,bV as Pr,E as L,aq as Gt,ar as Yt,b7 as Zt,b8 as Xt,ay as st,bC as Jt,d as P,y as C,G as _,m as p,z as F,bW as Q,j as m,a as n,B as D,T as d,aH as le,g as R,K as en,aI as ee,I as T,ba as Dr,b0 as Ee,v as j,r as f,L as Pe,bX as Nr,w as We,R as Fr,c as N,aQ as tn,W as ze,e as Ke,aw as Cr,as as nn,a0 as he,bY as at,A as H,l as O,ah as it,t as ce,b as be,N as ye,am as Ft,J as Ve,b5 as rn,bZ as V,aE as De,q as Ne,n as te,D as ne,o as re,p as G,F as Fe,ab as Ce,M as xe,b_ as q,b$ as ot,H as Qe,ad as sn,c0 as an,U as we,c1 as lt,c2 as Mr,a7 as on,Q as Lr,c3 as ln,bP as Ct,bG as Ar,u as je,bH as Mt,k as Rr,a6 as et,$ as Lt,i as Tr,az as Se,Z as He,bE as _r,c4 as $r,C as zr,X as Oe,P as cn,bx as ct,a$ as ge,bI as Or,c5 as Ur,bJ as Br,bL as Wr,s as dn,c6 as un,at as $e,c7 as Kr,c8 as Vr,c9 as Qr,ca as jr,bb as Hr,aO as qr,bA as Gr,x as Yr,cb as Zr,b4 as ae}from"./main.2bad25cd.js";import{X as mn,k as tt,j as nt,Y as qe,H as oe,T as pn,Q as fn,D as hn,a as gn,s as vn,c as bn,Z as Xr,_ as yn,P as Jr,p as xn,i as wn,y as dt,m as X,w as Ge,v as Sn,$ as es,B as Re,F as Te,C as ts,U as ns,d as At,a0 as Y,g as Ye,h as rs,x as kn,o as In,a1 as ss,a2 as Rt,E as as,M as ut,a3 as is,a4 as os,A as En,J as ls,z as cs,r as mt,t as ds,G as Tt,W as us,L as ms,q as ps,a5 as _t,b as $t}from"./date-picker.d8be8944.js";import{I as fs,S as hs,G as gs,a as vs,b as bs,P as Pn,A as ys,B as xs,F as pt,c as Dn,U as ws,D as Nn,C as ft,R as Ss,d as ks,e as Is,f as Es,g as Ps,h as Ds,i as Ns,j as Fs,k as Cs,V as Ms,l as Ls,m as As}from"./Info.6e21f778.js";import{B as ht,a as Ue,E as Rs,C as Ts}from"./Edit.2aa2741b.js";import{U as _s,A as $s}from"./ArrowBack.da4c6dca.js";import"./index.b7375da4.js";class zs extends Sr{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,r){super.setOptions({...t,behavior:Nt()},r)}getOptimisticResult(t){return t.behavior=Nt(),super.getOptimisticResult(t)}fetchNextPage({pageParam:t,...r}={}){return this.fetch({...r,meta:{fetchMore:{direction:"forward",pageParam:t}}})}fetchPreviousPage({pageParam:t,...r}={}){return this.fetch({...r,meta:{fetchMore:{direction:"backward",pageParam:t}}})}createResult(t,r){var s,a,i,o,l,u;const{state:c}=t;return{...super.createResult(t,r),fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:kr(r,(s=c.data)==null?void 0:s.pages),hasPreviousPage:Ir(r,(a=c.data)==null?void 0:a.pages),isFetchingNextPage:c.fetchStatus==="fetching"&&((i=c.fetchMeta)==null||(o=i.fetchMore)==null?void 0:o.direction)==="forward",isFetchingPreviousPage:c.fetchStatus==="fetching"&&((l=c.fetchMeta)==null||(u=l.fetchMore)==null?void 0:u.direction)==="backward"}}}function Fn(e,t,r){const s=Er(e,t,r);return Pr(s,zs)}const A={fetchEntries:e=>{const t=["drive-entries"];return e&&t.push(e),t},fetchUserFolders(e){const t=["user-folders"];return e&&t.push(e),t},fetchShareableLink:e=>{const t=["shareable-link"];return e&&t.push(e),t},fetchFolderPath(e,t){const r=["folder-path"];return e&&r.push(e),t&&r.push(t),r},fetchEntryShareableLink:e=>["file-entries",e,"shareable-link"],fetchFileEntry:e=>{const t=["drive/file-entries/model"];return e&&t.push(e),t},fetchStorageSummary:["storage-summary"]};function B(){L.invalidateQueries(A.fetchEntries()),L.invalidateQueries(A.fetchFolderPath()),L.invalidateQueries(A.fetchUserFolders()),L.invalidateQueries(A.fetchFileEntry())}const K=Gt()(Yt(e=>({password:null,viewMode:Zt("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(r=>{r.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(r=>{r.isPasswordProtected=t})},setViewMode:t=>{e(r=>{r.viewMode=t,Xt("drive.viewMode",t)})},setActiveSort:t=>{e(r=>{r.activeSort=t})}})));function pe(){return K.getState()}function Os({hash:e,page:t=1,order:r,password:s}){return P.get(`shareable-links/${e}`,{params:{withEntries:!0,page:t,order:r,password:s}}).then(a=>a.data)}function se(){var l,u;const{hash:e}=st(),{orderBy:t,orderDir:r}=K(c=>c.activeSort),s=`${t}:${r}`,a=K(c=>c.isPasswordProtected),i=K(c=>c.password),o=Fn(A.fetchShareableLink({hash:e,sort:s}),({pageParam:c=1})=>Os({hash:e,page:c,order:s,password:i}),{getNextPageParam:c=>{if(!c.folderChildren)return;const g=c.folderChildren.current_page,h=c.folderChildren.last_page;if(!(g>=h))return g+1},enabled:!!e&&!a||!!i,keepPreviousData:!0,retry:(c,g)=>zt(g)?!1:c<=2,onError:c=>{if(zt(c))return pe().setIsPasswordProtected(!0)}});return{...o,link:(l=o.data)==null?void 0:l.pages[0].link,entries:(u=o.data)==null?void 0:u.pages.flatMap(c=>{var g;return(g=c.folderChildren)==null?void 0:g.data})}}function zt(e){var t;return Jt.isAxiosError(e)&&((t=e.response)==null?void 0:t.data).passwordInvalid}function Us({password:e,linkHash:t}){return P.post(`shareable-links/${t}/check-password`,{password:e}).then(r=>r.data)}function Bs(){return C(e=>Us(e),{onSuccess:(e,t)=>{e.matches&&pe().setPassword(t.password)},onError:e=>_(e,p("Could not create link"))})}function Ws({linkId:e,password:t}){return P.post(`shareable-links/${e}/import`,{password:t}).then(r=>r.data)}function Ks(){const e=K(t=>t.password);return C(t=>Ws({...t,password:e}),{onSuccess:()=>{F(p("Item imported into your drive")),L.invalidateQueries(A.fetchShareableLink())},onError:t=>_(t,p("Could not create link"))})}function Cn(){var o;const{link:e}=se(),{user:t,isLoggedIn:r}=Q(),{downloadUrl:s}=mn(e==null?void 0:e.entry),a=Ks(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(l=>l.id===(t==null?void 0:t.id));return e!=null&&e.entry?m("div",{children:[e.allow_download&&n(D,{size:"sm",variant:"flat",color:"chip",startIcon:n(tt,{}),onClick:()=>{s&&nt(s)},children:n(d,{message:"Download"})}),!i&&r&&e.allow_edit&&m(le,{onItemSelected:l=>{l==="import"?a.mutate({linkId:e.id}):l==="download"&&s&&nt(s)},children:[n(R,{className:"ml-6",size:"sm",variant:"flat",color:"chip",radius:"rounded",disabled:a.isLoading,children:n(en,{})}),m(ee,{children:[n(T,{value:"download",startIcon:n(tt,{}),children:n(d,{message:"Download"})}),n(T,{value:"import",startIcon:n(fs,{}),children:n(d,{message:"Save a copy to your own drive"})})]})]})]}):null}function Mn(){const{link:e}=se();return n(Dr,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&n(Cn,{}),menuPosition:"shareable-link-page",children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&m("div",{className:"flex items-center gap-10",children:[n(Ee,{className:"flex-shrink-0",type:e.entry.type}),n("div",{className:"font-medium whitespace-nowrap overflow-hidden overflow-ellipsis flex-auto",children:e.entry.name})]})})}function Vs(){const{trans:e}=j(),{hash:t}=st(),r=e({message:"Password"}),[s,a]=f.exports.useState(""),i=Bs(),o=t?t.split(":")[0]:null,l=i.data&&!i.data.matches;return m("div",{className:"bg-alt w-full h-full flex flex-col",children:[n(Mn,{}),n("div",{className:"px-10 md:px-20 mx-auto my-80",children:m("div",{className:"flex flex-col md:flex-row gap-40 md:gap-14 bg items-center max-w-[560px] border rounded p-24",children:[n("div",{className:"h-132",children:n(Pe,{src:Nr})}),m("form",{onSubmit:u=>{u.preventDefault(),i.mutate({linkHash:o,password:s})},children:[n("span",{className:"text-sm",children:n(d,{message:"The link you are trying to access is password protected."})}),n(We,{autoFocus:!0,placeholder:r,"aria-label":r,className:"mt-10 mb-20",type:"password",value:s,required:!0,errorMessage:l&&n(d,{message:"Password is not valid"}),onChange:u=>{a(u.target.value)}}),n("div",{className:"text-right",children:n(D,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isLoading,children:n(d,{message:"Enter"})})})]})]})})]})}const Ln=Fr.forwardRef(({entry:e,className:t,isSelected:r,isMobileMode:s,footerAdornment:a,...i},o)=>m("div",{...i,ref:o,className:N("shadow rounded border aspect-square flex flex-col grid-item transition-shadow-opacity select-none overflow-hidden outline-none dark:bg-alt",r&&"border-primary",t),children:[n("div",{className:"flex-auto relative min-h-0",children:n(qe,{className:"h-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),n(Qs,{entry:e,isSelected:r,isMobile:s,adornment:a})]}));function Qs({entry:e,isSelected:t,isMobile:r,adornment:s}){return m("div",{className:N("text-sm h-48 flex items-center",r?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[n("div",{className:"min-w-0 whitespace-nowrap overflow-hidden overflow-ellipsis",children:e.name}),s]})}function js({entries:e,onEntrySelected:t}){return n("div",{className:"file-grid",children:e.map((r,s)=>n(Ln,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:r,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(r,s)},onClick:()=>{t(r,s)}},r.id))})}const Hs=tn(e=>oe(e)),gt=[{key:"name",allowsSorting:!0,header:()=>n(d,{message:"Name"}),body:e=>m("div",{className:"flex items-center gap-14",children:[n("div",{children:n(qe,{className:"w-24 h-24 rounded",iconClassName:"w-24 h-24",file:e})}),n("div",{className:"overflow-hidden overflow-ellipsis",children:e.name})]}),width:"w-5/6 max-w-1"},{key:"updated_at",allowsSorting:!0,header:()=>n(d,{message:"Last modified"}),body:e=>n(ze,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>n(d,{message:"Size"}),body:e=>{var t;return(t=Hs(e.file_size))!=null?t:"-"}}],qs=gt.filter(e=>e.key!=="updated_at");function Gs({entries:e,onEntrySelected:t}){const r=K(a=>a.activeSort),s=Ke();return n(pn,{columns:s?qs:gt,data:e,sortDescriptor:r,onSortChange:a=>{pe().setActiveSort(a)},onAction:(a,i)=>{t(a,i)},enableSelection:!1})}function Ys(e,t){var s;let r=e.hash;return t&&((s=e.entry)==null?void 0:s.hash)!==t&&(r=`${r}:${t}`),r}function An(){const{link:e}=se(),t=Cr();return r=>{!e||t(`/drive/s/${Ys(e,r)}`)}}function Zs({className:e}){const{pathname:t}=nn(),r=An(),[s,a]=f.exports.useState(),i=K(x=>x.viewMode),o=f.exports.useRef(null),{link:l,entries:u,isFetchingNextPage:c,hasNextPage:g,fetchNextPage:h,isPreviousData:v}=se();if(f.exports.useEffect(()=>{a(void 0)},[t]),f.exports.useEffect(()=>{const x=o.current;if(!x)return;const k=new IntersectionObserver(([I])=>{I.isIntersecting&&g&&h()});return k.observe(x),()=>{k.unobserve(x)}},[g,h]),!l||v)return n("div",{className:N("flex justify-center",e),children:n(he,{isIndeterminate:!0})});const y=(x,k)=>{x.type==="folder"?r(x.hash):a(k)},w=u||[];return m(f.exports.Fragment,{children:[n(at,{slot:"file-preview",className:"mb-40"}),m("div",{className:N("px-14 pb-14 md:px-24 md:pb-24 flex-auto overflow-auto file-grid-container",e),children:[i==="grid"?n(js,{entries:w,onEntrySelected:y}):n(Gs,{entries:w,onEntrySelected:y}),n("span",{ref:o,"aria-hidden":!0}),n(H,{children:c&&n(O.div,{className:"flex justify-center mt-24 w-full",...it,children:n(he,{isIndeterminate:!0,"aria-label":"loading"})})})]}),n(ce,{type:"modal",isOpen:s!=null,onClose:()=>a(void 0),children:n(fn,{entries:w,defaultActiveIndex:s,allowDownload:l.allow_download})})]})}function Rn({children:e,className:t}){return n("div",{className:N(t,"dashboard-grid-header"),children:e})}function Tn({hash:e,params:t,isEnabled:r=!0}){return be(A.fetchFolderPath(e,t),()=>Xs(e,t),{enabled:!!e&&r})}function Xs(e,t){return P.get(`folders/${e}/path`,{params:t}).then(r=>r.data)}function Js({className:e,folder:t,link:r}){const s=An(),a=K(l=>l.password),i=Tn({hash:t==null?void 0:t.hash,params:{shareable_link:r.id,password:a}});let o;if(i.isLoading)o=null;else{const l=[];i.data&&i.data.path.forEach(u=>{l.push({folder:u,label:n(ye,{children:u.name})})}),o=n(ht,{size:"lg",isNavigation:!0,children:l.map(u=>n(Ue,{onSelected:()=>{s(u.folder.hash)},children:u.label},u.folder.hash))})}return n("div",{className:N("h-36 flex-shrink-0",e),children:o})}const Ot=[{id:"file_size",label:p("Size")},{id:"name",label:p("Name")},{id:"updated_at",label:p("Last modified")},{id:"created_at",label:p("Upload date")},{id:"type",label:p("Type")},{id:"extension",label:p("Extension")}];function _n({descriptor:e,onChange:t,isDisabled:r=!1}){const s=e.orderBy,a=e.orderDir,i=Ot.find(o=>o.id===s);return m(le,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",s||""],onItemSelected:o=>{t(o==="asc"||o==="desc"?{orderBy:s,orderDir:o}:{orderBy:o,orderDir:a})},children:[n(D,{className:"text-muted",variant:"text",size:"sm",startIcon:n(hs,{}),disabled:r,children:i?n(d,{...i.label}):null}),m(ee,{children:[m(Ft,{label:n(d,{message:"Direction"}),children:[n(T,{value:"asc",children:n(d,{message:"Ascending"})}),n(T,{value:"desc",children:n(d,{message:"Descending"})})]}),n(Ft,{label:n(d,{message:"Sort By"}),children:Ot.map(o=>n(T,{value:o.id,children:n(d,{...o.label})},o.id))})]})]})}function ea(){const e=K(a=>a.activeSort),{link:t,isFetching:r}=se(),s=t&&t.entry;return m("div",{className:"md:flex-row flex flex-col md:items-center gap-14 justify-between p-14 md:p-24 md:h-90",children:[s&&n(Js,{link:t,folder:t.entry,className:"flex-auto"}),s&&m("div",{className:"flex items-center justify-between md:justify-start text-muted",children:[n(_n,{isDisabled:r,descriptor:e,onChange:a=>{pe().setActiveSort(a)}}),n("div",{className:"md:border-l md:pl-10 ml-10",children:n(R,{onClick:()=>{pe().setViewMode(pe().viewMode==="grid"?"list":"grid")},children:n(gs,{})})})]})]})}const $n=""+new URL("share.70babf29.svg",import.meta.url).href;function ta(){const{entries:e,isFetched:t}=se(),r=t&&!(e!=null&&e.length);return m(hn,{name:"folder-preview",children:[n(gn,{hideToggleButton:!0,rightChildren:n(Cn,{}),color:"bg"}),n(Rn,{children:n(ea,{})}),n(vn,{children:n(bn,{children:r?n(na,{}):n(Zs,{})})})]})}function na({className:e}){return n(Ve,{className:N(e,"mt-80"),image:n(Pe,{src:$n}),title:n(d,{message:"Folder is empty"}),description:n(d,{message:"No files have been uploaded to this folder yet"})})}function ra(){const{link:e}=se();return e!=null&&e.entry?m("div",{className:"flex flex-col w-full h-full bg-alt",children:[n(Mn,{}),n(at,{slot:"file-preview",className:"mt-24"}),n(Xr,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function sa(){var o;const{status:e,link:t}=se(),{trans:r}=j(),s=K(l=>l.isPasswordProtected),a=K(l=>l.password);let i;if(e==="loading")i=n("div",{className:"flex-auto flex items-center justify-center w-full h-full",children:n(he,{"aria-label":r({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!s)return n(rn,{});s&&!a?i=n(Vs,{}):((o=t==null?void 0:t.entry)==null?void 0:o.type)==="folder"?i=n(ta,{}):i=n(ra,{})}return n(yn.Provider,{value:{shareable_link:t==null?void 0:t.id,password:a},children:i})}function zn(){return be(A.fetchStorageSummary,aa,{select:ia})}function aa(){return P.get("user/space-usage").then(e=>e.data)}function ia(e){const t=e.available===null?0:e.used*100/e.available;return{usedFormatted:oe(e.used),availableFormatted:oe(e.available),percentage:t,used:e.used,available:e.available}}function oa(e){return n(Jr,{...e,role:"meter progressbar"})}function la(){const{isLoading:e,data:t}=zn(),r=n("span",{className:N("whitespace-nowrap",e&&"invisible"),children:n(d,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return m("div",{className:"pl-24 pt-24 mt-24 border-t flex items-start gap-16",children:[n(vs,{className:"icon-md -mt-4"}),n(oa,{className:"flex-auto max-w-144",size:"xs",value:t==null?void 0:t.percentage,label:r,showValueLabel:!1,labelPosition:"bottom"})]})}function ca(e){return C(t=>da(t),{onSuccess:()=>{F(p("Created workspace")),L.invalidateQueries(V.fetchUserWorkspaces)},onError:t=>De(t,e)})}function da(e){return P.post("workspace",e).then(t=>t.data)}function ua(){const e=Ne(),{formId:t,close:r}=te(),s=ca(e);return m(ne,{children:[n(re,{children:n(d,{message:"Create workspace"})}),n(G,{children:n(Fe,{form:e,id:t,onSubmit:()=>{s.mutate(e.getValues(),{onSuccess:a=>{r(a.workspace.id)}})},children:n(Ce,{name:"name",autoFocus:!0,label:n(d,{message:"Workspace name"}),minLength:3,required:!0})})}),m(xe,{children:[n(D,{variant:"text",onClick:r,children:n(d,{message:"Cancel"})}),n(D,{variant:"flat",color:"primary",type:"submit",form:t,disabled:s.isLoading,children:n(d,{message:"Create"})})]})]})}function ma(e){return P.get(`workspace/${e}`).then(t=>t.data)}function pa(e){return be(V.workspaceWithMembers(e),()=>ma(e))}function fa({workspaceId:e,...t}){return P.post(`workspace/${e}/invite`,t).then(r=>r.data)}function ha(){return C(e=>fa(e),{onSuccess:(e,t)=>{L.invalidateQueries(V.workspaceWithMembers(t.workspaceId))},onError:e=>_(e)})}function ga({workspaceId:e,inviteId:t,...r}){return P.post(`workspace/${e}/${t}/resend`,r).then(s=>s.data)}function va(){return C(e=>ga(e),{onSuccess:()=>{F("Invite sent")},onError:e=>_(e)})}const ba=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function On(e){return!e||e.length>320?!1:ba.test(e)}function ya({workspaceId:e,member:t,...r}){const s=t.model_type,a=t.model_type==="invite"?t.id:t.member_id;return P.post(`workspace/${e}/${s}/${a}/change-role`,r).then(i=>i.data)}function xa(){return C(e=>ya(e),{onSuccess:(e,t)=>{F(p("Role changed")),L.invalidateQueries(V.workspaceWithMembers(t.workspaceId))},onError:e=>_(e)})}function wa({workspaceId:e,memberId:t,memberType:r}){const s=r==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return P.delete(s).then(a=>a.data)}function Un(){const{workspaceId:e,setWorkspaceId:t}=q(),{user:r}=Q();return C(s=>wa(s),{onSuccess:(s,a)=>{L.invalidateQueries(V.fetchUserWorkspaces),L.invalidateQueries(V.workspaceWithMembers(a.workspaceId)),a.memberId===(r==null?void 0:r.id)&&e===a.workspaceId&&t(ot.id)},onError:s=>_(s)})}function Bn(){return n(Qe,{isDanger:!0,title:n(d,{message:"Leave workspace"}),body:m("div",{children:[n(d,{message:"Are you sure you want to leave this workspace?"}),n("div",{className:"font-semibold mt-8",children:n(d,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:n(d,{message:"Leave"})})}function Sa({workspace:e}){const{data:t,isLoading:r}=pa(e.id);return m(ne,{size:"lg",children:[n(re,{children:n(d,{message:"Manage workspace members"})}),n(G,{children:r?n("div",{className:"flex items-center justify-center min-h-[238px]",children:n(he,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):n(ka,{workspace:t.workspace})})]})}function ka({workspace:e}){const t=vt(e),r=[...e.members||[],...e.invites||[]];return m("div",{children:[t.invite&&n(Pa,{workspace:e}),m("div",{className:"flex items-center gap-10 mb-14 text-base",children:[n(bs,{className:"icon-sm"}),n(d,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),n(H,{initial:!1,children:r.map(s=>n(Ia,{workspace:e,member:s},`${s.model_type}.${s.id}`))})]})}function Ia({workspace:e,member:t}){return m(O.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-start text-sm gap-14 mb-20",children:[n("img",{className:"w-36 h-36 rounded flex-shrink-0",src:t.avatar,alt:""}),m("div",{className:"md:flex flex-auto items-center justify-between gap-14 min-w-0",children:[m("div",{className:"overflow-hidden mb-10 md:mb-0 md:mr-10",children:[m("div",{className:"flex items-center justify-start gap-6",children:[n("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.display_name}),n(Fa,{workspace:e,member:t})]}),n("div",{className:"text-muted",children:t.email})]}),n(Ea,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function vt(e){var i;const{user:t}=Q(),r={update:!1,invite:!1,delete:!1},s=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(t==null?void 0:t.id));return a&&s.forEach(o=>{var l;r[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(u=>u.name===`workspace_members.${o}`))}),r}function Ea({workspace:e,member:t}){const[r,s]=f.exports.useState(t.role_id),a=xa(),{user:i}=Q(),o=vt(e),l=t.model_type==="member"&&t.is_owner,u=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,c=!o.update||l||u?n("div",{className:"text-muted ml-auto first:capitalize",children:n(d,{message:t.role_name})}):n(Wn,{className:"ml-auto flex-shrink-0",size:"xs",value:r,isDisabled:a.isLoading,onChange:g=>{s(g),a.mutate({roleId:g,workspaceId:e.id,member:t})}});return m(ye,{children:[c,!l&&(u||o.delete)&&n(Da,{type:u?"leave":"remove",member:t,workspace:e})]})}function Pa({workspace:e}){const{trans:t}=j(),[r,s]=f.exports.useState([]),a=r.every(g=>!g.invalid),i=g=>g.description||g.name,[o,l]=f.exports.useState(),u=ha(),{data:c}=sn(["workspaceRoles"]);return f.exports.useEffect(()=>{var g;!o&&((g=c==null?void 0:c.workspaceRoles)==null?void 0:g.length)&&l(c.workspaceRoles[0].id)},[c,o]),m("div",{className:"mb-30",children:[n(xn,{value:r,onChange:s,displayWith:i,validateWith:g=>{const h=!On(g.description);return{...g,invalid:h,errorMessage:h?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:n(d,{message:"Invite people"})}),m("div",{className:"flex items-center gap-14 justify-between mt-14",children:[n(Wn,{onChange:l,value:o}),r.length&&o?n(D,{variant:"flat",color:"primary",size:"sm",disabled:u.isLoading||!a,onClick:()=>{u.mutate({emails:r.map(g=>i(g)),roleId:o,workspaceId:e.id},{onSuccess:()=>{s([])}})},children:n(d,{message:"Invite"})}):null]})]})}function Da({member:e,workspace:t,type:r}){const s=Un(),{close:a}=te();return m(ce,{type:"modal",onClose:i=>{i&&(s.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),r==="leave"&&(a(),F(p("Left workspace"))))},children:[n(R,{size:"md",className:"text-muted flex-shrink-0",disabled:s.isLoading,children:r==="leave"?n(an,{}):n(we,{})}),r==="leave"?n(Bn,{}):n(Na,{member:e})]})}function Na({member:e}){return n(Qe,{isDanger:!0,title:n(d,{message:"Remove member"}),body:m("div",{children:[n(d,{message:"Are you sure you want to remove `:name`?",values:{name:e.display_name}}),n("div",{className:"font-semibold mt-8",children:n(d,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.display_name}})})]}),confirm:n(d,{message:"Remove"})})}function Wn({value:e,onChange:t,size:r="xs",className:s,isDisabled:a}){var l;const{data:i}=sn(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(u=>u.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:m(le,{selectionMode:"single",selectedValue:e,onSelectionChange:u=>{t(u)},children:[n(D,{className:s,size:r,variant:"flat",color:"chip",disabled:a,endIcon:n(lt,{}),children:o.name}),n(ee,{children:i.workspaceRoles.map(u=>n(T,{value:u.id,description:u.description,children:u.name},u.id))})]})}function Fa({member:e,workspace:t}){const{user:r}=Q(),s=vt(t);return(r==null?void 0:r.id)===e.id?m("div",{className:"font-medium",children:["(",n(d,{message:"You"}),")"]}):e.model_type==="invite"?m("div",{className:"flex items-center gap-4",children:[n("div",{children:"\xB7"}),n("div",{className:"font-medium",children:n(d,{message:"Invited"})}),s.invite?m(ye,{children:[n("div",{children:"\xB7"}),n(Ca,{member:e,workspace:t})]}):null]}):null}function Ca({member:e,workspace:t}){const r=va();return m(ce,{type:"modal",onClose:s=>{s&&r.mutate({workspaceId:t.id,inviteId:e.id})},children:[n(D,{variant:"link",size:"sm",color:"primary",disabled:r.isLoading,children:n(d,{message:"Resend invite"})}),n(Qe,{title:n(d,{message:"Resend invite"}),body:n(d,{message:"Are you sure you want to send this invite again?"}),confirm:n(d,{message:"Send"})})]})}function Ma({id:e,...t}){return P.put(`workspace/${e}`,t).then(r=>r.data)}function La(e){const{close:t}=te();return C(r=>Ma(r),{onSuccess:r=>{t(),F(p("Updated workspace")),L.invalidateQueries(V.fetchUserWorkspaces),L.invalidateQueries(V.workspaceWithMembers(r.workspace.id))},onError:r=>De(r,e)})}function Aa({workspace:e}){const t=Ne({defaultValues:{id:e.id,name:e.name}}),{formId:r,close:s}=te(),a=La(t);return m(ne,{children:[n(re,{children:n(d,{message:"Rename workspace"})}),n(G,{children:n(Fe,{form:t,id:r,onSubmit:()=>{a.mutate(t.getValues())},children:n(Ce,{name:"name",autoFocus:!0,label:n(d,{message:"Name"}),minLength:3,required:!0})})}),m(xe,{children:[n(D,{variant:"text",onClick:s,children:n(d,{message:"Cancel"})}),n(D,{variant:"flat",color:"primary",type:"submit",form:r,disabled:a.isLoading,children:n(d,{message:"Rename"})})]})]})}function Ra({id:e}){return P.delete(`workspace/${e}`).then(t=>t.data)}function Ta(){const{workspaceId:e,setWorkspaceId:t}=q();return C(r=>Ra(r),{onSuccess:(r,s)=>{F(p("Deleted workspace")),L.invalidateQueries(V.fetchUserWorkspaces),L.invalidateQueries(V.workspaceWithMembers(s.id)),e===s.id&&t(ot.id)},onError:r=>_(r)})}function _a({onChange:e,className:t}){const{data:r,isFetched:s,isFetching:a}=Mr(),{workspaceId:i,setWorkspaceId:o}=q(),l=r==null?void 0:r.find(v=>v.id===i),[u,c]=f.exports.useState(null),[g,h]=f.exports.useState(!1);return f.exports.useEffect(()=>{s&&!a&&!l&&o(ot.id)},[l,r,o,s,a]),l?m(f.exports.Fragment,{children:[m(ce,{type:"popover",isOpen:g,onClose:()=>{h(!1)},children:[m(on,{onClick:()=>{h(!g)},className:N("flex items-center gap-10 hover:bg-hover rounded ring-inset focus-visible:ring-2",t),children:[m("span",{className:"block flex-auto mr-auto text-left overflow-hidden",children:[n("span",{className:"block text-sm text-main font-medium overflow-hidden overflow-ellipsis",children:l.default?n(d,{message:l.name}):l.name}),n("span",{className:"block text-muted text-xs",children:l.default?n(d,{message:"Personal workspace"}):n(d,{message:":count members",values:{count:l.members_count}})})]}),n(_s,{className:"icon-md shrink-0"})]}),n(ne,{size:"min-w-320",children:m(G,{padding:"p-10",children:[n("div",{className:"mb-16 pb-10 border-b",children:r.map(v=>n($a,{workspace:v,setDialog:c,setSelectorIsOpen:h,onChange:e},v.id))}),n("div",{className:"text-center mb-4 px-4",children:n(D,{onClick:v=>{v.preventDefault(),v.stopPropagation(),c({name:"newWorkspace"}),h(!1)},variant:"outline",startIcon:n(wn,{}),color:"primary",className:"w-full h-40",children:n(d,{message:"Create new workspace"})})})]})})]}),n(za,{dialog:u,setDialog:c,onChange:e})]}):null}function $a({workspace:e,onChange:t,setSelectorIsOpen:r,setDialog:s}){const{workspaceId:a,setWorkspaceId:i}=q(),o=a===e.id;return m("div",{onClick:()=>{i(e.id),t(e.id),r(!1)},className:N("p-10 mb-4 text-left flex items-center gap-12 rounded-lg cursor-pointer",o&&"bg-primary/5",!o&&"hover:bg-hover"),children:[n(Lr,{size:"sm",className:N("flex-shrink-0 text-primary",!o&&"invisible")}),m("div",{className:"flex-auto",children:[n("div",{className:N("text-sm",o&&"font-semibold"),children:e.name}),n("div",{className:"text-muted text-sm",children:n(d,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&n(Ua,{setSelectorIsOpen:r,workspace:e,setDialog:s})]})}function za({dialog:e,setDialog:t,onChange:r}){const s=Ta(),a=Un(),{user:i}=Q(),{setWorkspaceId:o}=q();return m(ce,{type:"modal",isOpen:!!(e!=null&&e.name),onClose:l=>{(e==null?void 0:e.name)==="deleteWorkspace"&&l&&s.mutate({id:e.workspace.id}),(e==null?void 0:e.name)==="leaveWorkspace"&&l&&(i==null?void 0:i.id)&&a.mutate({workspaceId:e.workspace.id,memberId:i.id,memberType:"member"}),(e==null?void 0:e.name)==="newWorkspace"&&l&&(o(l),r==null||r(l)),t(null)},children:[(e==null?void 0:e.name)==="newWorkspace"&&n(ua,{}),(e==null?void 0:e.name)==="updateWorkspace"&&n(Aa,{workspace:e.workspace}),(e==null?void 0:e.name)==="workspaceMembers"&&n(Sa,{workspace:e.workspace}),(e==null?void 0:e.name)==="deleteWorkspace"&&n(Oa,{workspace:e.workspace}),(e==null?void 0:e.name)==="leaveWorkspace"&&n(Bn,{})]})}function Oa({workspace:e}){return n(Qe,{isDanger:!0,title:n(d,{message:"Delete workspace"}),body:n(d,{message:"Are you sure you want to delete \u201C:name\u201C?",values:{name:e.name}}),confirm:n(d,{message:"Delete"})})}function Ua({setSelectorIsOpen:e,setDialog:t,workspace:r}){const{user:s}=Q();return m(le,{onItemSelected:a=>{e(!1),t({name:a,workspace:r})},children:[n(D,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:n(en,{}),children:n(d,{message:"Manage"})}),m(ee,{children:[n(T,{onClick:a=>a.stopPropagation(),value:"workspaceMembers",startIcon:n(Pn,{}),children:n(d,{message:"Members"})}),r.owner_id===(s==null?void 0:s.id)&&n(T,{onClick:a=>a.stopPropagation(),value:"updateWorkspace",startIcon:n(Rs,{}),children:n(d,{message:"Rename"})}),r.owner_id!==(s==null?void 0:s.id)&&n(T,{onClick:a=>a.stopPropagation(),value:"leaveWorkspace",startIcon:n(an,{}),children:n(d,{message:"Leave"})}),r.owner_id===(s==null?void 0:s.id)&&n(T,{onClick:a=>a.stopPropagation(),value:"deleteWorkspace",startIcon:n(dt,{}),children:n(d,{message:"Delete"})})]})]})}const Ba=""+new URL("add-files.107c40dd.svg",import.meta.url).href,Wa=""+new URL("time-management.5219b76e.svg",import.meta.url).href,Ut=""+new URL("file-searching.49556098.svg",import.meta.url).href,Ka=""+new URL("throw-away.389510cc.svg",import.meta.url).href,Va=""+new URL("loving-it.585c130e.svg",import.meta.url).href,Me={orderBy:"updated_at",orderDir:"desc"};function bt(e){return{...Kn(e.hash),canUpload:e.permissions["files.update"],label:e.name,folder:e}}function Kn(e){return{id:e,label:"",path:Ze(e),hasActions:!0,canUpload:!1,sortDescriptor:Me,isFolderPage:!0,noContentMessage:()=>({title:p("Drop files or folders here"),description:p('Or use the "Upload" button'),image:Ba})}}function Ze(e){return e==="0"?"/drive":`/drive/folders/${e}`}const Qa=ln().rootFolder,$=bt(Qa),ja={id:"recent",label:p("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:p("No recent entries"),description:p("You have not uploaded any files or folders yet"),image:Wa})},J={id:"search",label:p("Search results"),path:"/drive/search",sortDescriptor:Me,noContentMessage:e=>e?{title:p("No matching results"),description:p("Try changing your search query or filters"),image:Ut}:{title:p("Begin typing or select a filter to search"),description:p("Search for files, folders and other content"),image:Ut}},ve={id:"shares",label:p("Shared"),path:"/drive/shares",sortDescriptor:Me,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:p("Shared with me"),description:p("Files and folders other people have shared with you"),image:$n})},z={id:"trash",label:p("Trash"),path:"/drive/trash",sortDescriptor:Me,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:p("Trash is empty"),description:p("There are no files or folders in your trash currently"),image:Ka})},Ha={id:"starred",label:p("Starred"),path:"/drive/starred",sortDescriptor:Me,queryParams:{starredOnly:!0},noContentMessage:()=>({title:p("Nothing is starred"),description:p("Add stars to files and folders that you want to easily find later"),image:Va})},qa=[$,ja,J,ve,z,Ha];var Vn=(e=>(e.DriveSidebar="drive-sidebar",e))(Vn||{}),Qn={};(function(e){var t=Ct&&Ct.__assign||function(){return(t=Object.assign||function(o){for(var l,u=1,c=arguments.length;u<c;u++)for(var g in l=arguments[u])Object.prototype.hasOwnProperty.call(l,g)&&(o[g]=l[g]);return o}).apply(this,arguments)},r=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function s(o,l){l===void 0&&(l={});for(var u,c=t(t({},r),l),g=[],h={},v=c.throwIfOrphans?new Set:null,y=0,w=o;y<w.length;y++){var x=w[y],k=c.nestedIds?i(x,c.id):x[c.id],I=c.nestedIds?i(x,c.parentId):x[c.parentId];if(c.rootParentIds[k])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(k,'", `rootParentIds`: ').concat(Object.keys(c.rootParentIds).map(function(U){return'"'.concat(U,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(h,k)||(h[k]=((u={})[c.childrenField]=[],u)),v&&v.delete(k),c.dataField?h[k][c.dataField]=x:c.assign?h[k]=Object.assign(x,((u={})[c.childrenField]=h[k][c.childrenField],u)):h[k]=t(t({},x),((x={})[c.childrenField]=h[k][c.childrenField],x)),x=h[k],I==null||c.rootParentIds[I]?g.push(x):(Object.prototype.hasOwnProperty.call(h,I)||(h[I]=((k={})[c.childrenField]=[],k),v&&v.add(I)),h[I][c.childrenField].push(x))}if(v!=null&&v.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(v),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(c.throwIfOrphans&&a(g,c.childrenField)<Object.keys(h).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return g}function a(o,l){return o.reduce(function(u,c){return u+1+(c[l]&&a(c[l],l))},0)}function i(o,l){return l.split(".").reduce(function(u,c){return u&&u[c]},o)}e.arrayToTree=s,e.countNodes=a})(Qn);function Ga(e){return P.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function yt(){const{user:e}=Q(),{workspaceId:t}=q(),r={userId:e.id,workspaceId:t};return be(A.fetchUserFolders(r),()=>Ga(r),{enabled:!!e})}const Ya=[];Ar();var Ht,qt;const Bt={uploadQueueIsOpen:!1,contextMenuData:null,selectedEntries:new Set,entriesBeingDragged:[],activeActionDialog:null,sidebarExpandedKeys:[],viewMode:Zt("drive.viewMode",((qt=(Ht=ln().settings)==null?void 0:Ht.drive)==null?void 0:qt.default_view)||"grid"),sortDescriptor:{orderBy:"updated_at",orderDir:"desc"}},S=Gt()(Yt((e,t)=>({...Bt,setUploadQueueIsOpen:r=>{e(s=>{s.uploadQueueIsOpen=r})},setContextMenuData:r=>{e(s=>{s.contextMenuData=r})},setSortDescriptor:r=>{e(s=>{s.sortDescriptor=r})},setActivePage:r=>{e(s=>{s.activePage=r,s.sortDescriptor=r.sortDescriptor})},setEntriesBeingDragged:r=>{e(s=>{s.entriesBeingDragged=r})},setActiveActionDialog:(r,s=Ya)=>{e(a=>{const i=t().activeActionDialog;((i==null?void 0:i.name)!==r||i.entries!==s)&&(a.activeActionDialog=r?{name:r,entries:s}:null)})},setViewMode:r=>{e(s=>{s.viewMode=r,Xt("drive.viewMode",r)})},setSidebarExpandedKeys:r=>e(s=>{s.sidebarExpandedKeys=r}),expandSidebarItem:r=>e(s=>{s.sidebarExpandedKeys.includes(r)||s.sidebarExpandedKeys.push(r)}),collapseSidebarItem:r=>e(s=>{const a=s.sidebarExpandedKeys.indexOf(r);a>-1&&s.sidebarExpandedKeys.splice(a,1)}),toggleSidebarItem:r=>e(s=>{s.sidebarExpandedKeys.includes(r)?s.expandSidebarItem(r):s.collapseSidebarItem(r)}),selectEntries:(r,s)=>{e(a=>{s||a.selectedEntries.clear(),r.forEach(i=>i&&a.selectedEntries.add(i))})},deselectEntries:r=>{e(s=>{!s.selectedEntries.size||(r==="all"?s.selectedEntries=new Set:r.forEach(a=>s.selectedEntries.delete(a)))})},reset:()=>{e(Bt)}})));function b(){return S.getState()}function Za(){const e=S(t=>t.activeActionDialog);return e==null?void 0:e.entries[0]}function jn(){return C(e=>Xa(e),{onSuccess:(e,t)=>{B(),F(p('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||$.folder).name}}))},onError:e=>_(e,p("Could not move items"))})}function Xa(e){return e.destinationId=e.destinationId?e.destinationId:null,P.post("file-entries/move",e).then(t=>t.data)}const Ja=8388608;function Le(){var g;const e=X(h=>h.uploadMultiple),t=S(h=>h.activePage),{data:r}=zn(),{workspaceId:s}=q(),a=((g=t==null?void 0:t.folder)==null?void 0:g.id)||null,{uploads:i}=je(),o=i.max_size||Ja,l=i.allowed_extensions,u=i.blocked_extensions;return{uploadFiles:f.exports.useCallback((h,v={})=>{if(v.metadata||(v.metadata={}),v.metadata.workspaceId=s,v.metadata.parentId||(v.metadata.parentId=a),h=[...h].map(y=>y instanceof Mt?y:new Mt(y)),r){const y=h.reduce((k,I)=>k+I.size,0),w=r.used,x=r.available;if(y+w>x){F.danger(p("You have exhausted your allowed space of :space. Delete some files or upgrade your plan.",{values:{space:r.availableFormatted}}),{action:{action:"/pricing",label:p("Upgrade")}});return}}e(h,{...v,restrictions:{maxFileSize:o,allowedFileTypes:l,blockedFileTypes:u},onSuccess:y=>{var w;(w=v==null?void 0:v.onSuccess)==null||w.call(v,y),B(),L.invalidateQueries(A.fetchStorageSummary)}}),b().setUploadQueueIsOpen(!0)},[e,a,s,l,u,o,r])}}function xt(e,t){return t.type!=="folder"?!1:e.every(r=>!r||t.id===r.parent_id||!r.parent_id&&t.id===0?!1:!ei(t,r))}function ei(e,t){const r=(e.path||"").split("/");return(t.path||"").split("/").every((a,i)=>r[i]===a)}function Hn(e){const t=jn(),{uploadFiles:r}=Le();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")r(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();(i==null?void 0:i.length)&&xt(i,e)&&t.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)})}}}}}function rt(e,t){if(e.type==="fileEntry"){const r=e.getData();return xt(r,t)}return!0}function wt(e){return`${e.id}-tree`}function ti(e){return`${e}`.endsWith("-tree")}function ni({folder:e,ref:t}){const[r,s]=f.exports.useState(!1),{onDrop:a}=Hn(e);return{...Ge({id:wt(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:o=>rt(o,e),onDragEnter:o=>{rt(o,e)&&s(!0)},onDragLeave:()=>{s(!1)},onDropActivate:()=>{b().sidebarExpandedKeys.includes(e.id)||b().setSidebarExpandedKeys([...b().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:r}}const St=f.exports.createContext(null);function qn({nodes:e,itemRenderer:t,parentNode:r,level:s}){return e.map((a,i)=>f.exports.cloneElement(t(a),{level:s==null?0:s+1,index:i,node:a,parentNode:r,key:a.id,itemRenderer:t}))}const Gn=f.exports.forwardRef(({icon:e,label:t,level:r=0,node:s,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:u,selectedKeys:c,setSelectedKeys:g}=f.exports.useContext(St),h=l.includes(s.id),v=c.includes(s.id),y=w=>{w.stopPropagation();const x=l.indexOf(s.id),k=[...l];x>-1?k.splice(x,1):k.push(s.id),u(k)};return m("div",{...i,ref:o,onClick:w=>{w.stopPropagation(),g([s.id])},className:N("flex flex-nowrap whitespace-nowrap items-center gap-4 py-6 rounded header cursor-pointer overflow-hidden text-ellipsis tree-label",a,v&&"bg-primary/selected text-primary font-bold",!v&&"hover:bg-hover"),children:[r>0&&n("div",{className:"flex",children:Array.from({length:r}).map((w,x)=>n("div",{className:"w-24 h-24"},x))}),n("div",{onClick:y,children:n(ys,{className:N("icon-sm cursor-default transition-transform",h&&"rotate-90")})}),e,n("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});Gn.displayName="TreeLabel";function ri({label:e,icon:t,node:r,level:s,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:u,parentNode:c,...g}){const h=Rr(),{expandedKeys:v,selectedKeys:y,focusedNode:w,setFocusedNode:x,setExpandedKeys:k,setSelectedKeys:I}=f.exports.useContext(St);if(f.exports.useEffect(()=>()=>{w===(r==null?void 0:r.id)&&x(void 0)},[w,r==null?void 0:r.id,x]),!r||!i)return null;const U=r.children.length,W=U&&v.includes(r.id),de=y.includes(r.id),M=s===0&&a===0,Ae=w==null?M:w===r.id;return m("li",{role:"treeitem","aria-expanded":W?"true":"false","aria-selected":de,tabIndex:Ae?0:-1,onKeyDown:et(E=>{var ke,Dt;if(w!=null)switch(E.key){case"Enter":case" ":E.stopPropagation(),E.preventDefault(),I([w]);break;case"ArrowRight":if(E.stopPropagation(),E.preventDefault(),!U)return;W?h.focusNext():k([...v,w]);break;case"ArrowLeft":if(E.stopPropagation(),E.preventDefault(),W){const Z=v.indexOf(w),ue=[...v];ue.splice(Z,1),k(ue)}else if(c){const Z=(Dt=(ke=document.activeElement)==null?void 0:ke.parentElement)==null?void 0:Dt.closest("[tabindex]");Z&&Z.focus()}break;case"ArrowDown":E.stopPropagation(),E.preventDefault(),h.focusNext();break;case"ArrowUp":E.stopPropagation(),E.preventDefault(),h.focusPrevious();break;case"Home":E.stopPropagation(),E.preventDefault(),h.focusFirst();break;case"End":E.stopPropagation(),E.preventDefault(),h.focusLast();break;case"*":if(E.stopPropagation(),E.preventDefault(),c!=null&&c.children){const Z=[...v];c.children.forEach(ue=>{ue.children.length&&!v.includes(ue.id)&&Z.push(ue.id)}),Z.length!==v.length&&k(Z)}break}}),onFocus:E=>{E.stopPropagation(),x(r.id)},onBlur:E=>{E.stopPropagation(),E.currentTarget.contains(E.relatedTarget)||x(void 0)},className:N("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",u),children:[n(Gn,{ref:o,className:l,node:r,level:s,label:e,icon:t,...g}),n(H,{initial:!1,children:W?n(O.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:qn({nodes:r.children,parentNode:r,itemRenderer:i,level:s})},`${r.id}-group`):null})]})}function si({children:e,nodes:t,...r}){const[s,a]=Lt(r.expandedKeys,r.defaultSelectedKeys,r.onExpandedKeysChange),[i,o]=Lt(r.selectedKeys,r.defaultSelectedKeys,r.onSelectedKeysChange),[l,u]=f.exports.useState(),c={expandedKeys:s,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:u};return n(St.Provider,{value:c,children:n(Tr,{children:n(ai,{nodes:t,itemRenderer:e})})})}function ai(e){return n("ul",{className:"overflow-hidden text-sm",role:"tree",children:qn(e)})}function ii(){const e=Se(),{data:t}=yt(),r=S(o=>o.sidebarExpandedKeys),s=S(o=>o.activePage);let a=[];s!=null&&s.isFolderPage&&(a=s.folder?[s.folder.id]:[]);const i=f.exports.useMemo(()=>{const o=Qn.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...$.folder,children:o}]},[t==null?void 0:t.folders]);return n(si,{nodes:i,expandedKeys:r,onExpandedKeysChange:o=>{b().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=Yn(o,i);e(l?Ze(l):$.path)},children:()=>n(oi,{})})}function oi(e){const{node:t}=e,r=f.exports.useRef(null),s=t.id===0,a=S(u=>u.entriesBeingDragged.includes(t.id)),{draggableProps:i}=Sn({type:"fileEntry",id:wt(t),ref:r,disabled:s,hidePreview:!0,onDragStart:(u,c)=>{const g=c;b().setEntriesBeingDragged(g.getData().map(h=>h.id)),b().selectEntries([])},onDragEnd:()=>{b().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:o,isDragOver:l}=ni({folder:t,ref:r});return n(ri,{...He(i,o,e),onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),b().deselectEntries("all"),b().setContextMenuData({x:u.clientX,y:u.clientY,entry:t})},labelRef:r,className:s?"focus-visible:ring-2":void 0,labelClassName:N(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",s&&"h-40"),icon:s?n(xs,{size:"md",className:"mr-6"}):n(pt,{size:"sm",className:"mr-4"}),label:t.name})}const Yn=(e,t)=>{for(const r of t){if(r.id===e)return r.hash;if(r.children){const s=Yn(e,r.children);if(s)return s}}};function li(e){return P.post("file-entries/delete",e).then(t=>t.data)}function kt(){return C(e=>li(e),{onSuccess:(e,{entryIds:t,emptyTrash:r})=>{B(),L.invalidateQueries(A.fetchStorageSummary),r?F(p("Emptied trash")):F(p("Deleted [one 1 item|other :count items]",{values:{count:t.length}}))},onError:(e,{emptyTrash:t})=>{const r=_r(e);r?F.danger(r):t?F.danger("could not empty trash"):F.danger("Could not delete items")}})}function ci(){return q(),m("div",{className:"text-muted mt-26 px-12",children:[n(ii,{}),n(zr,{menu:Vn.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?n(di,{item:e},e.id):n(Zn,{item:e},e.id)})]})}const Zn=f.exports.forwardRef(({item:e,className:t,...r},s)=>n($r,{className:({isActive:a})=>N(t,"h-40 w-full my-4 px-24 rounded",a?"text-primary font-bold bg-primary/selected cursor-default":"hover:bg-hover"),item:e,ref:s,...r}));function di({item:e}){const t=kt(),[r,s]=f.exports.useState(!1),a=f.exports.useRef(null),{droppableProps:i}=Ge({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{s(!0)},onDragLeave:()=>{s(!1)},onDrop:o=>{const l=o.getData().map(u=>u.id);t.mutate({entryIds:l,deleteForever:!1})}});return n(Zn,{className:N(r&&"bg-primary/selected"),ref:a,...i,item:e})}function Xn({isCompact:e,className:t}){const r=S(i=>i.activePage),{uploadFiles:s}=Le(),a=e?n(R,{size:"md",children:n(wn,{})}):n(D,{className:"min-w-160",color:"primary",variant:"flat",size:"sm",startIcon:n(Dn,{}),disabled:!(r!=null&&r.canUpload),children:n(d,{message:"Upload"})});return n("div",{className:t,children:m(le,{onItemSelected:async i=>{var o;if(i==="uploadFiles")s(await Oe({multiple:!0}));else if(i==="uploadFolder")s(await Oe({directory:!0}));else if(i==="newFolder"){const l=(o=b().activePage)==null?void 0:o.folder;b().setActiveActionDialog("newFolder",l?[l]:[])}},children:[a,m(ee,{children:[n(T,{value:"uploadFiles",startIcon:n(ws,{}),children:n(d,{message:"Upload files"})}),n(T,{value:"uploadFolder",startIcon:n(Nn,{}),children:n(d,{message:"Upload folder"})}),n(T,{value:"newFolder",startIcon:n(ft,{}),children:n(d,{message:"Create folder"})})]})]})})}function ui({className:e}){const{isSubscribed:t}=Q(),{billing:r}=je();return m("div",{className:N(e,"text-sm text-muted font-medium bg-alt border-r flex flex-col gap-20"),children:[m("div",{className:"flex-auto",children:[n(Xn,{className:"text-center px-12 pt-28"}),n(ci,{}),n(la,{}),r.enable&&n("div",{className:"pl-60 mt-14",children:n(D,{elementType:cn,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:n(d,{message:"Upgrade"})})})]}),n(mi,{})]})}function mi(){const e=Se();return n(_a,{onChange:()=>{e($.path)},className:"w-full px-24 py-18 border-t flex-shrink-0 mt-auto"})}function pi(e){return P.get("drive/file-entries",{params:e}).then(t=>t.data)}const fi=e=>{const r=e.pages[0].folder,s=b().activePage;return r&&s&&s.id===r.hash&&s.label!==r.name&&b().setActivePage(r.id===0?$:bt(r)),e};function Jn(){const e=S(l=>l.activePage),t=S(l=>l.sortDescriptor),[r]=ct(),{workspaceId:s}=q(),a={pageId:e==null?void 0:e.id,...e==null?void 0:e.queryParams,...Object.fromEntries(r),folderId:e!=null&&e.isFolderPage?e.id:null,workspaceId:s,...t},i=e===J&&!a.query&&!a.filters,o=Fn(A.fetchEntries(a),({pageParam:l=1})=>pi({...a,page:l}),{getNextPageParam:l=>{const u=l.current_page,c=l.last_page;if(!(u>=c))return u+1},enabled:e!=null&&!i});return f.exports.useEffect(()=>{o.data&&fi(o.data)},[o.data]),o}function hi(){return L.getQueriesData(A.fetchEntries()).reduce((t,r)=>{const s=r[1]?r[1].pages.flatMap(a=>a.data):[];return[...t,...s]},[])}const er=[es,new Re({type:Te.Select,key:"owner_id",label:p("Owner"),description:p("User file was uploaded by"),defaultValue:"02",options:[{key:"01",label:p("anyone"),value:{value:null,operator:"!="}},{key:"02",label:p("me"),value:"{authId}"},{key:"03",label:p("not me"),value:{value:"{authId}",operator:"!="}}]}),new ts({description:p("Date file was uploaded")}),new ns({description:p("Date file was last changed")}),new Re({type:Te.BooleanToggle,key:"deleted_at",label:p("In trash"),description:p("Only show files that are in the trash"),defaultOperator:At.ne,defaultValue:null}),new Re({type:Te.BooleanToggle,key:"shareableLink",label:p("Has shareable link"),description:p("Only show files that have a shareable link"),defaultValue:"*",defaultOperator:At.has}),new Re({type:Te.BooleanToggle,key:"sharedByMe",label:p("Shared by me"),description:p("Only show files that are shared with someone"),defaultValue:!0})],gi=er.map(e=>e.key);function vi(){const e=S(r=>r.activePage),{isMobileMode:t}=f.exports.useContext(Y);return e!==J?null:m("div",{className:"mt-10 mb-30 px-10 md:px-26",children:[t&&n(We,{autoFocus:!0,className:"mb-20",startAdornment:n(Ye,{}),placeholder:"Type to search"}),n(rs,{filters:er,pinnedFilters:gi})]})}function bi(e,t){const r={...e};r.left=Math.max(0,r.left);const s=r.left-e.left;s>0&&(r.width-=s),r.top=Math.max(0,r.top);const a=r.top-e.top;return a>0&&(r.height-=a),r.width=Math.min(r.width,t.width-r.left),r.height=Math.min(r.height,t.height-r.top),r}const Ie=new Map;function yi(e){const{id:t,ref:r}=e,s=f.exports.useRef(e);s.current=e,f.exports.useLayoutEffect(()=>{if(!!r.current)return Ie.set(t,{...Ie.get(t),id:t,ref:r,onSelected:()=>{var a,i;(i=(a=s.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=s.current).onDeselected)==null?void 0:i.call(a)}}),()=>{kn.delete(t)}},[t,s,r])}function xi(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function wi({onPointerDown:e,...t}={}){const r=f.exports.useRef(null),s=t.containerRef||r,a=f.exports.useRef(null);let i=f.exports.useRef({}).current;const o=()=>{var I,U,W,de,M,Ae,Je;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const u=i.startPoint,c=i.endPoint,g=u.scrollTop||0,h=((I=s.current)==null?void 0:I.scrollTop)||0,v={left:Math.min(u.x,c.x),top:Math.min(u.y,c.y),width:Math.abs(u.x-c.x),height:Math.abs(u.y-c.y)};v.left-=i.boundaryRect.left,v.top-=i.boundaryRect.top,v.top+=g;const y=h-g,w=Math.abs(y);y<0&&(v.top-=w),v.height+=w;const x=i.boundaryRect?bi(v,i.boundaryRect):{...v};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${x.left}px, ${x.top}px)`,a.current.style.width=`${x.width}px`,a.current.style.height=`${x.height}px`),i.rafId=void 0}));const k={...x,left:x.left+i.boundaryRect.left,top:x.top+i.boundaryRect.top-h};for(const[,E]of Ie){const ke=xi(E.rect,k);ke&&!((U=i.selectedIds)!=null&&U.has(E.id))?((W=i.selectedIds)==null||W.add(E.id),(de=E.onSelected)==null||de.call(E)):!ke&&((M=i.selectedIds)==null?void 0:M.has(E.id))&&((Ae=i.selectedIds)==null||Ae.delete(E.id),(Je=E.onDeselected)==null||Je.call(E))}};return{containerProps:{...In({minimumMovement:4,onPointerDown:e,onMoveStart:u=>{if(ss)return!1;Rt(Ie),i={selectedIds:new Set};const c=s.current;if(i.startPoint={x:u.clientX,y:u.clientY,scrollTop:(c==null?void 0:c.scrollTop)||0},i.scrollListener=g=>{var h;!i.startPoint||(Rt(Ie),(h=i.boundaryRect)!=null&&h.height&&(i.boundaryRect.height=g.target.scrollHeight),o())},c){const g=c.getBoundingClientRect();c.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:g.top,left:g.left,height:c.scrollHeight,heightWithoutScroll:g.height,width:c.scrollWidth}}},onMove:u=>{if(i.endPoint={x:u.clientX,y:u.clientY},i.boundaryRect&&s.current){const c=u.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,g=u.clientY-20<i.boundaryRect.top;c?s.current.scrollBy({top:10}):g&&s.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),s.current&&i.scrollListener&&s.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:s},boxProps:{ref:a}}}function Si(e){return e?P.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function tr(){return C(({entryId:e})=>Si(e),{onSuccess:(e,{entryId:t})=>{L.setQueryData(A.fetchEntryShareableLink(t),e)},onError:e=>_(e,p("Could not create link"))})}function ki({entryIds:e}){return P.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function Ii(){return C(e=>ki(e),{onSuccess:(e,{entryIds:t})=>{B(),F(p("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>_(e,p("Could not star items"))})}function Ei({entryIds:e}){return P.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function Pi(){return C(e=>Ei(e),{onSuccess:(e,{entryIds:t})=>{B(),F(p("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>_(e,p("Could not remove star"))})}function Di(e){return P.post("file-entries/duplicate",e).then(t=>t.data)}function Ni(){return C(e=>Di(e),{onSuccess:(e,t)=>{B(),L.invalidateQueries(A.fetchStorageSummary),F(p("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>_(e,p("Could not duplicate items"))})}function nr(){return C(e=>Fi(e),{onSuccess:()=>{B()}})}function Fi({entryIds:e,...t}){return P.post(`file-entries/${e.join(",")}/unshare`,t).then(r=>r.data)}function Ci(){return C(e=>Mi(e),{onSuccess:(e,t)=>{B(),F(p("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>_(e,p("Could not restore items"))})}function Mi(e){return P.post("file-entries/restore",e).then(t=>t.data)}function rr(e){const t=sr(e),r=It(e),s=Li(e),a=Ai(e),i=Ri(e),o=Ti(e),l=_i(e),u=$i(e),c=zi(e),g=ar(e),h=ir(e),v=Oi(e);return[t,r,s,a,i,o,l,u,c,g,h,v].filter(y=>!!y)}function sr(e){if(!!e.some(t=>t.type!=="folder"))return{label:p("Preview"),icon:Ss,key:"preview",execute:()=>{b().setActiveActionDialog("preview",e)}}}function It(e){const t=S(r=>r.activePage);if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===z))return{label:p("Share"),icon:Pn,key:"share",execute:()=>{b().setActiveActionDialog("share",e)}}}function Li(e){const t=S(s=>s.activePage),r=tr();if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===z))return{label:p("Get link"),icon:as,key:"getLink",execute:()=>{r.mutate({entryId:e[0].id}),b().setActiveActionDialog("getLink",e)}}}function Ai(e){const t=S(s=>s.activePage),r=Ii();if(!(e.every(s=>{var a;return(a=s.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(s=>s.permissions["files.update"])||t===z))return{label:p("Add to starred"),icon:ks,key:"addToStarred",execute:()=>{r.mutate({entryIds:e.map(s=>s.id)}),b().selectEntries([])}}}function Ri(e){const t=S(s=>s.activePage),r=Pi();if(!(!e.every(s=>{var a;return(a=s.tags)==null?void 0:a.find(i=>i.name==="starred")})||t===z))return{label:p("Remove from starred"),icon:Is,key:"removeFromStarred",execute:()=>{r.mutate({entryIds:e.map(s=>s.id)}),b().selectEntries([])}}}function Ti(e){const t=S(r=>r.activePage);if(!(!e.every(r=>r.permissions["files.update"])||t===ve||t===z))return{label:p("Move to"),icon:Es,key:"moveTo",execute:()=>{b().setActiveActionDialog("moveTo",e)}}}function _i(e){const t=S(r=>r.activePage);if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===z))return{label:p("Rename"),icon:Ps,key:"rename",execute:()=>{b().setActiveActionDialog("rename",e)}}}function $i(e){const t=S(s=>s.activePage),r=Ni();if(!(e.length>1||!e.every(s=>s.permissions["files.update"])||t===z))return{label:p("Make a copy"),icon:Ds,key:"makeCopy",execute:()=>{r.mutate({entryIds:e.map(s=>s.id)}),b().selectEntries([])}}}function zi(e){const{downloadUrl:t}=mn(e[0],{downloadHashes:e.map(r=>r.hash)});if(!!e.every(r=>r.permissions["files.download"]))return{label:p("Download"),icon:tt,key:"download",execute:()=>{t&&nt(t),b().selectEntries([])}}}function ar(e){const t=kt(),r=S(s=>s.activePage);if(!(r===ve||!e.every(s=>s.permissions["files.delete"])))return{label:r===z?p("Delete forever"):p("Delete"),icon:dt,key:"delete",execute:()=>{t.mutate({entryIds:e.map(s=>s.id),deleteForever:r===z}),b().selectEntries([])}}}function Oi(e){const t=Ci();if(!(S(s=>s.activePage)!==z||!e.every(s=>s.permissions["files.delete"])))return{label:p("Restore"),icon:Ns,key:"restore",execute:()=>{t.mutate({entryIds:e.map(s=>s.id)}),b().selectEntries([])}}}function ir(e){const t=nr();if(S(s=>s.activePage)===ve)return{label:p("Remove"),icon:dt,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(s=>s.id),userId:"me"},{onSuccess:(s,a)=>{F(p("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:s=>_(s,p("Could not remove items"))}),b().selectEntries([])}}}function or(e){const t=Ui(e),r=Bi(e),s=Wi(e),a=Ki();return[t,r,s,a].filter(i=>!!i)}function Ui(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:p("New folder"),icon:ft,key:"newFolder",execute:()=>{e.folder&&b().setActiveActionDialog("newFolder",[e.folder])}}}function Bi(e){const{uploadFiles:t}=Le();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:p("Upload files"),icon:Dn,key:"uploadFiles",execute:async()=>{t(await Oe({multiple:!0}))}}}function Wi(e){const{uploadFiles:t}=Le();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:p("Upload folder"),icon:Nn,key:"uploadFolder",execute:async()=>{t(await Oe({directory:!0}))}}}function Ki(e){const t=kt();if(S(s=>s.activePage)===z)return{label:p("Empty trash"),icon:Fs,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),b().selectEntries([])}}}function Xe({children:e,entries:t,page:r}){return r===$?n(Kt,{page:$,children:e}):r===z?n(Kt,{page:z,children:e}):r!=null&&r.folder?n(Wt,{entries:[r.folder],children:e}):t!=null&&t.length?n(Wt,{entries:t,children:e}):null}function Wt({entries:e,children:t}){const r=rr(e);return n(lr,{actions:r,children:t})}function Kt({page:e,children:t}){const r=or(e);return n(lr,{actions:r,children:t})}function lr({actions:e,children:t}){return m(le,{children:[t,n(ee,{children:e.map(r=>n(T,{onSelected:()=>{r.execute()},value:r.key,startIcon:f.exports.createElement(r.icon),children:n(d,{...r.label})},r.key))})]})}function Et(){const e=Jn();return e.data?e.data.pages.flatMap(t=>t.data):[]}function Pt(){const e=S(r=>r.selectedEntries),t=Et();return Array.from(e).map(r=>t.find(s=>s.id===r)).filter(r=>!!r)}function cr(){return Pt()[0]}function Vi(){const e=cr(),{data:t}=yt();if(!(!e||!t))return t.folders.find(r=>r.id===e.parent_id)}function dr(){const e=Array.from(b().selectedEntries),t=hi();return e.map(r=>t.find(s=>s.id===r))}function ur({className:e}){const t=Pt();return t.length?n("div",{className:e,children:n(Qi,{entries:t})}):null}function Qi({entries:e}){const t=sr(e),r=It(e),s=ar(e),a=ir(e),i=[t,r,s,a].filter(o=>!!o);return m("div",{className:"entry-action-list",children:[i.map(o=>n(ge,{label:n(d,{...o.label}),children:n(R,{size:"sm",onClick:()=>{o.execute()},children:f.exports.createElement(o.icon)})},o.key)),n(Xe,{entries:e,children:n(ge,{label:n(d,{message:"More actions"}),children:n(R,{children:n(ut,{})})})})]})}const Vt=e=>{e.preventDefault()};function ji({position:e,children:t,...r}){const s=Or({...r,isOpen:r.isOpen&&!!e,placement:"right-start",floatingWidth:"auto",offset:{mainAxis:5,alignmentAxis:4},role:"menu",loopFocus:!0,children:(t==null?void 0:t.type)===ee?t.props.children:t}),{reference:a,refs:i,state:{isOpen:o,setIsOpen:l,activeIndex:u},focusItem:c,listContent:g}=s;f.exports.useEffect(()=>{if(i.floating.current)return i.floating.current.addEventListener("contextmenu",Vt),()=>{var y;(y=i.floating.current)==null||y.removeEventListener("contextmenu",Vt)}},[i.floating]),f.exports.useEffect(()=>{if(e){const{x:y,y:w}=e;a({getBoundingClientRect(){return{x:y,y:w,width:0,height:0,top:w,right:y,bottom:w,left:y}}}),l(!0)}},[e,a,l]);const{handleListboxKeyboardNavigation:h}=Wr(s),{findMatchingItem:v}=Ur();return n(Br,{listbox:s,onKeyDownCapture:y=>{if(!o)return;const w=v(y,g,u);w&&c("increment",w)},onKeyDown:h})}function Hi(){var a;const e=Pt(),t=S(i=>i.activePage),r=S(i=>i.contextMenuData),s=r!=null&&r.entry?[r.entry]:e;return((a=r==null?void 0:r.entry)==null?void 0:a.id)===0?n(Qt,{position:r,page:$}):r&&s.length?n(qi,{entries:s,position:r}):r&&t?n(Qt,{position:r,page:t}):null}function qi({entries:e,position:t}){const r=rr(e);return n(mr,{position:t,actions:r})}function Qt({page:e,position:t}){const r=or(e);return n(mr,{position:t,actions:r})}function mr({position:e,actions:t}){return n(ji,{position:e,onOpenChange:r=>{r||b().setContextMenuData(null)},children:t.map(r=>n(T,{value:r.key,onSelected:r.execute,startIcon:f.exports.createElement(r.icon),children:n(d,{...r.label})},r.key))})}function pr(e){const t=is(),r=f.exports.useRef(null),{onDrop:s}=Hn(e),[a,i]=f.exports.useState(!1),o=S(g=>g.entriesBeingDragged.includes(e.id)),{draggableProps:l}=Sn({disabled:!!t,id:e.id,type:"fileEntry",ref:r,hidePreview:!0,onDragStart:(g,h)=>{b().selectedEntries.has(e.id)||b().selectEntries([e.id]),b().setEntriesBeingDragged(h.getData().map(v=>v.id))},onDragEnd:()=>{b().setEntriesBeingDragged([])},getData:()=>dr()}),{droppableProps:u}=Ge({id:e.id,disabled:t||e.type!=="folder",ref:r,types:["fileEntry","nativeFile"],acceptsDrop:g=>rt(g,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:s});yi({id:e.id,ref:r,onSelected:()=>{b().selectEntries([e.id],!0)},onDeselected:()=>{b().deselectEntries([e.id])}});const c=N(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:l,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:c,ref:r}}function Gi({item:e,children:t,className:r,...s}){const{isMobileMode:a}=f.exports.useContext(Y),{draggableProps:i,droppableProps:o,itemClassName:l,ref:u}=pr(e);return n("tr",{className:N(r,l,a?"h-64":null),ref:u,...He(i,o,s,{onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),a||(b().selectedEntries.has(e.id)||b().selectEntries([e.id]),b().setContextMenuData({x:c.clientX,y:c.clientY}))}}),children:t})}function fr(){const e=Se();return{performViewItemAction:f.exports.useCallback(r=>{if(r&&r.type==="folder")e(Ze(r.hash));else{const s=dr();b().setActiveActionDialog("preview",s.length?s:[r])}},[e])}}const Yi=tn(e=>oe(e)),Zi=[{key:"name",allowsSorting:!0,hideHeader:!0,header:()=>n(d,{message:"User"}),body:e=>m("div",{className:"flex items-center gap-14",children:[n(qe,{className:"w-30 h-30 rounded",iconClassName:"w-28 h-28",file:e}),m("div",{children:[n("div",{children:e.name}),m("div",{className:"text-muted text-xs flex items-center mt-4",children:[n(ze,{date:e.updated_at}),n("div",{children:"\xB7"}),n("div",{children:Yi(e.file_size)})]})]})]}),width:"col-w-3"},{key:"actions",hideHeader:!0,header:()=>n(d,{message:"Actions"}),align:"end",padding:"pl-12 pr-4",body:(e,t)=>t.length?n(dn,{className:"block mr-8",checked:t.includes(e.id)}):n(Xe,{entries:[e],children:n(R,{className:"text-muted",children:n(ut,{})})})}];function Xi({entries:e}){const t=Ke(),{performViewItemAction:r}=fr(),s=S(o=>o.selectedEntries),a=S(o=>o.sortDescriptor),i=f.exports.useMemo(()=>[...s],[s]);return n(pn,{hideHeaderRow:!!t,columns:t?Zi:gt,data:e,sortDescriptor:a,onSortChange:o=>{b().setSortDescriptor(o)},onAction:r,selectedRows:i,selectionStyle:"highlight",renderRowAs:Gi,onSelectionChange:o=>{b().selectEntries(o)}})}function Ji({entry:e}){const t=S(y=>y.selectedEntries.has(e.id)),{performViewItemAction:r}=fr(),{isMobileMode:s}=f.exports.useContext(Y),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=pr(e),u=()=>{t?b().deselectEntries([e.id]):b().selectEntries([e.id],!0)},c=(y,w)=>{s?b().selectedEntries.size?u():r(e):b().selectEntries([e.id],os(y))},{domProps:g}=In({onLongPress:s?()=>u():void 0,onPress:c}),h=y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),y.stopPropagation(),r(e))},v=y=>{y.preventDefault(),y.stopPropagation(),s||(b().selectedEntries.has(e.id)||b().selectEntries([e.id]),b().setContextMenuData({x:y.clientX,y:y.clientY}))};return n(Ln,{...He(a,i,g,{onKeyDown:et(h)}),ref:l,entry:e,isSelected:t,isMobileMode:!!s,tabIndex:-1,onDoubleClick:y=>{y.preventDefault(),y.stopPropagation(),s||r(e)},footerAdornment:s&&n(eo,{entry:e,isSelected:t}),onContextMenu:et(v),className:o})}function eo({entry:e,isSelected:t}){return S(s=>s.selectedEntries.size)?n(dn,{className:"block mr-8",checked:t}):n(Xe,{entries:[e],children:n(R,{className:"text-muted",onPointerDown:s=>{s.stopPropagation()},children:n(ut,{})})})}function to({entries:e}){return n("div",{className:"file-grid-container",children:n("div",{className:"file-grid",children:e.map(t=>n(Ji,{entry:t},t.id))})})}function hr({isDisabled:e}){const t=S(r=>r.sortDescriptor);return n(_n,{isDisabled:e,descriptor:t,onChange:r=>{b().setSortDescriptor(r)}})}function gr({className:e}){const{isMobileMode:t}=f.exports.useContext(Y),r=Se(),s=S(g=>g.activePage),a=s==null?void 0:s.folder,i=Tn({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==$.folder.hash}),o=un(),l=no(),u=!s||!o||s.isFolderPage&&!a||i.fetchStatus!=="idle";let c;if(u)c=null;else{const g=l?[l]:[];i.data&&i.data.path.forEach(h=>{g.push({page:bt(h),label:h.name})}),c=n(ht,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:g.map((h,v)=>v===g.length-1?n(Ue,{children:({isMenuItem:w})=>w||!h.page.folder&&h.page!==z?n($e,{value:h.label}):n(Xe,{page:h.page,children:m(on,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[n($e,{value:h.label}),n(lt,{className:"icon-md text-muted"})]})})},h.page.id):n(Ue,{onSelected:()=>{r(h.page.path)},children:n($e,{value:h.label})},h.page.id))})}return c}function no(){var s,a;const e=S(i=>i.activePage),t=un(),{user:r}=Q();if(!e)return null;if(t&&!t.default&&(e==null?void 0:e.isFolderPage)&&(e===$||((s=e.folder)==null?void 0:s.workspace_id)===t.id))return{label:t.name,page:$};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(r==null?void 0:r.id)?{label:ve.label,page:ve}:{label:$.label,page:$}}return{label:e.label,page:e}}function ro({onIntersection:e,isFetchingNextPage:t,hasNextPage:r}){const s=f.exports.useRef(null);return f.exports.useEffect(()=>{const a=s.current;if(!a)return;const i=new IntersectionObserver(([o])=>{o.isIntersecting&&r&&e()});return i.observe(a),()=>{i.unobserve(a)}},[e,r]),m(ye,{children:[n("span",{ref:s,"aria-hidden":!0}),n(H,{children:t&&n(O.div,{className:"flex justify-center mt-24 w-full",...it,children:n(he,{isIndeterminate:!0,"aria-label":"loading"})})})]})}function so({isVisible:e}){const t=n(O.div,{...it,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:n(O.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:n(d,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return n(H,{children:e?t:null})}function ao({className:e}){const[t]=ct(),r=!!t.get("query")||!!t.get("filters"),s=f.exports.useRef(null),{hasNextPage:a,isFetchingNextPage:i,fetchNextPage:o,isLoading:l,fetchStatus:u}=Jn(),c=Et(),{uploadFiles:g}=Le(),h=S(M=>M.activePage),[v,y]=f.exports.useState(!1),w=S(M=>M.viewMode),{isMobileMode:x}=f.exports.useContext(Y),{containerProps:k,boxProps:I}=wi({containerRef:s,onPointerDown:M=>{M.target.closest(".entry-action-list")||b().deselectEntries("all")}}),{droppableProps:U}=Ge({id:"driveRoot",ref:s,types:["nativeFile"],onDragEnter:()=>{y(!0)},onDragLeave:()=>{y(!1)},onDrop:async M=>{M.type==="nativeFile"&&g(await M.getData())}});if(!h)return null;let W;if(!c.length&&(!l||u==="idle")){const M=h.noContentMessage(r);W=n(Ve,{className:"mt-40",image:n(Pe,{src:M.image}),title:n(d,{...M.title}),description:n(d,{...M.description})})}else l||(W=w==="list"?n(Xi,{entries:c}):n(to,{entries:c}));const de=M=>{M.preventDefault(),M.stopPropagation(),b().deselectEntries("all"),b().setContextMenuData({x:M.clientX,y:M.clientY})};return n("div",{className:N("relative",e),...He(k,U),onContextMenu:de,children:m("div",{className:"flex flex-col relative pt-10 min-h-full",children:[x?n(gr,{className:"px-14 mb-10"}):n(io,{}),n(vi,{}),m("div",{className:"px-18 md:px-24 pb-18 flex-auto relative",children:[n(at,{slot:"drive",className:"mb-24"}),W,n(ro,{onIntersection:o,isFetchingNextPage:i,hasNextPage:a})]}),n("div",{...I,className:"absolute bg-primary-light/20 border border-primary-light z-10 pointer-events-none shadow-md left-0 top-0 hidden"}),n(Hi,{}),n(so,{isVisible:v})]})})}function io(){const e=S(t=>t.activePage);return m("div",{className:"px-10 md:px-18 my-10 flex items-center gap-40 justify-between text-muted min-h-42",children:[n(hr,{isDisabled:e==null?void 0:e.disableSort}),n(ur,{className:"text-muted"})]})}const oo=f.exports.memo(({file:e})=>m("div",{className:"p-10 flex items-center gap-14",children:[n("div",{className:"shrink-0 border rounded p-8",children:n(Ee,{className:"w-22 h-22",mime:e.mime})}),m("div",{className:"flex-auto min-w-0 pr-10",children:[n("div",{className:"mb-2 flex items-center min-w-0 gap-10",children:n("div",{className:"flex-auto font-medium whitespace-nowrap min-w-0 overflow-hidden overflow-ellipsis",children:e.name})}),n(lo,{file:e})]}),n("div",{className:"mr-10",children:n(co,{file:e})})]}));function lo({file:e}){const t=X(o=>o.fileUploads.get(e.id)),r=(t==null?void 0:t.bytesUploaded)||0,s=f.exports.useMemo(()=>oe(e.size),[e]),a=f.exports.useMemo(()=>oe(r),[r]);let i;return(t==null?void 0:t.status)==="completed"?i=n(d,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?i=n(d,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?i=n(d,{message:"Upload failed"}):i=n(d,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:s}}),n("div",{className:"text-muted text-xs",children:i})}function co({file:e}){const t=X(h=>h.fileUploads.get(e.id)),r=X(h=>h.abortUpload),s=(t==null?void 0:t.percentage)||0,a=t==null?void 0:t.status,i=t==null?void 0:t.errorMessage,[o,l]=f.exports.useState(!1),u=n(R,{size:"sm",onClick:()=>{r(e.id)},children:n(we,{})}),c=n(he,{"aria-label":"Upload progress",size:"sm",value:s});let g;if(a==="failed"){const h=i||p("This file could not be uploaded");g=n(_e,{children:n(ge,{variant:"danger",label:n($e,{value:h}),children:n(Kr,{className:"text-danger",size:"md"})})})}else a==="aborted"?g=n(_e,{children:n(Vr,{className:"text-warning",size:"md"})}):a==="completed"?g=n(_e,{children:n(Qr,{size:"md",className:"text-positive"})}):g=n(_e,{onPointerEnter:h=>{h.pointerType==="mouse"&&l(!0)},onPointerLeave:h=>{h.pointerType==="mouse"&&l(!1)},children:o?u:c});return n(H,{children:g})}function _e({children:e,...t}){return n(O.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function uo(){const e=S(t=>t.uploadQueueIsOpen);return n(H,{children:e&&m(O.div,{className:"shadow-xl rounded fixed bottom-16 right-16 bg z-modal border w-375 text-sm",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[n(mo,{}),n("div",{className:"max-h-320 overflow-y-auto",children:n(po,{})})]},"upload-queue")})}function mo(){const e=X(a=>a.inProgressUploadsCount),t=X(a=>a.completedUploadsCount),r=X(a=>a.clearInactive);let s;return e?s=n(d,{message:"Uploading :count files",values:{count:e}}):t?s=n(d,{message:"Uploaded :count files",values:{count:t}}):s=n(d,{message:"No active uploads"}),m("div",{className:"px-10 py-4 bg-alt flex items-center gap-10 justify-between border-b min-h-[45px]",children:[s,e===0?n(R,{size:"sm",onClick:()=>{b().setUploadQueueIsOpen(!1),setTimeout(()=>{r()},200)},children:n(we,{})}):void 0]})}function po(){const e=X(t=>t.fileUploads);return n(ye,{children:[...e.values()].map(t=>n(oo,{file:t.file},t.file.id))})}const fo=""+new URL("detailed-examination.33c85772.svg",import.meta.url).href;function ho({className:e}){const t=cr();return n("div",{className:N(e,"bg p-24 text-sm text-muted border-l h-full overflow-y-auto"),children:t?n(go,{entry:t}):n(bo,{})})}function vr({entryType:e,entryName:t}){const{setRightSidenavStatus:r}=f.exports.useContext(Y);return m("div",{className:"flex items-center gap-16 text-text-main mb-38",children:[n(Ee,{className:"w-24 h-24",type:e}),n("div",{className:"text-xl font-normal text-ellipsis flex-auto mr-auto min-w-0 break-words",children:t}),n(R,{size:"md",className:"flex-shrink-0",onClick:()=>{r("closed")},children:n(we,{})})]})}function go({entry:e}){return m("div",{children:[n(vr,{entryType:e.type,entryName:e.name}),e.type==="image"&&n(qe,{className:"mb-20",file:e}),m("div",{children:[n(br,{children:n(d,{message:"Who has access"})}),m("div",{className:"flex items-center gap-14",children:[e.workspace_id?n("div",{className:"rounded-full border w-32 h-32 flex items-center justify-center",children:n(Cs,{className:"icon-md"})}):null,e.users.map(t=>n(ge,{label:t.display_name,children:n(En,{src:t.avatar,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&n(D,{className:"block mt-20",variant:"link",color:"primary",onClick:()=>{b().setActiveActionDialog("share",[e])},children:n(d,{message:"Manage Access"})})]}),n(vo,{entry:e})]})}function br({children:e}){return n("div",{className:"text-base text-main mb-20",children:e})}function vo({entry:e}){const t=Vi(),r=Se(),s=e.users.find(i=>i.owns_entry),a=f.exports.useMemo(()=>oe(e.file_size),[e.file_size]);return m("div",{className:"mt-20 border-t pt-20",children:[n(br,{children:n(d,{message:"Properties"})}),n(me,{label:n(d,{message:"Type"}),value:n("span",{className:"capitalize",children:n(d,{message:e.type})})}),n(me,{label:n(d,{message:"Size"}),value:e.file_size?a:"-"}),n(me,{label:n(d,{message:"Location"}),value:n(D,{variant:"link",startIcon:n(pt,{}),onClick:()=>{r(t?Ze(t.hash):$.path)},children:t?t.name:n(d,{message:"Root"})})}),s&&n(me,{label:n(d,{message:"Owner"}),value:s.display_name}),n(me,{label:n(d,{message:"Modified"}),value:n(ze,{date:e.updated_at})}),n(me,{label:n(d,{message:"Created"}),value:n(ze,{date:e.updated_at})})]})}function me({label:e,value:t}){return m("div",{className:"flex items-center mb-14",children:[n("div",{className:"w-1/3 text-sm text-muted",children:e}),n("div",{className:"w-2/3 text-sm text-main",children:t})]})}function bo(){return m(ye,{children:[n(vr,{entryType:"folder",entryName:n(d,{message:"All files"})}),n(Ve,{image:n(Pe,{src:fo}),description:n(d,{message:"Select file or folder to see details here"})})]})}function yo(e){return C(t=>xo(t),{onSuccess:(t,r)=>{B(),F(p(":oldName renamed to :newName",{values:{oldName:r.initialName,newName:t.fileEntry.name}}))},onError:t=>De(t,e)})}function xo({entryId:e,...t}){return P.put(`file-entries/${e}`,t).then(r=>r.data)}function wo({entries:e}){var l;const{close:t,formId:r}=te(),s=(l=e[0])==null?void 0:l.name,a=Ne({defaultValues:{name:s}}),i=yo(a);return m(ne,{children:[n(re,{children:n(d,{message:"Rename"})}),n(G,{children:n(Fe,{onSubmit:u=>{i.mutate({entryId:e[0].id,name:u.name,initialName:s},{onSuccess:t})},form:a,id:r,children:n(Ce,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),m(xe,{children:[n(D,{variant:"flat",onClick:()=>t(),children:n(d,{message:"Cancel"})}),n(D,{form:r,type:"submit",variant:"flat",color:"primary",disabled:i.isLoading||!a.formState.isDirty,children:n(d,{message:"Save"})})]})]})}function So({name:e,parentId:t}){return P.post("folders",{name:e,parentId:t===0?null:t}).then(r=>r.data)}function ko(e){return C(({name:t,parentId:r})=>So({name:t,parentId:r}),{onSuccess:()=>B(),onError:t=>De(t,e)})}function yr({parentId:e}){const{close:t,formId:r}=te(),{trans:s}=j(),a=Ne({defaultValues:{name:s({message:"Untitled Folder"})}}),i=ko(a);return m(ne,{children:[n(re,{children:n(d,{message:"New Folder"})}),n(G,{children:n(Fe,{onSubmit:l=>{i.mutate({...l,parentId:e},{onSuccess:u=>{t(u.folder),F(p("Folder created"))}})},form:a,id:r,children:n(Ce,{placeholder:s({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),m(xe,{children:[n(D,{variant:"flat",onClick:()=>t(),children:n(d,{message:"Cancel"})}),n(D,{form:r,type:"submit",variant:"flat",color:"primary",disabled:i.isLoading,children:n(d,{message:"Create"})})]})]})}function Io({selectedEntry:e}){const t=Et().filter(i=>i.type!=="folder"),r=t.findIndex(i=>i.id===(e==null?void 0:e.id)),[s,a]=f.exports.useState(r);return n(fn,{allowDownload:e.permissions["files.download"],headerActionsLeft:n(Eo,{activeIndex:s,entries:t}),activeIndex:s,onActiveIndexChange:a,entries:t})}function Eo({activeIndex:e,entries:t}){const r=t[e],s=It([r]),a=Ke();return!r||!s?null:a?n(R,{onClick:()=>{s.execute()},children:f.exports.createElement(s.icon)}):n(D,{variant:"text",startIcon:f.exports.createElement(s.icon),onClick:()=>{s.execute()},children:n(d,{...s.label})})}function Po({entryId:e,...t}){return P.post(`file-entries/${e}/share`,t).then(r=>r.data)}function Do(){return C(e=>Po(e),{onSuccess:()=>{B()},onError:e=>{var t,r;if(Jt.isAxiosError(e)&&e.response){const s=e.response.data;(t=s.errors)!=null&&t.emails?F.danger((r=s.errors)==null?void 0:r.emails[0]):_(e)}}})}const No={edit:!0,view:!0,download:!0},fe=[{key:"view",value:{view:!0},label:p("Can view")},{key:"download",value:{view:!0,download:!0},label:p("Can Download")},{key:"edit",value:No,label:p("Can edit")}];function xr({value:e,onChange:t}){return m(le,{selectedValue:e.key,selectionMode:"single",onSelectionChange:r=>{r!==e.key&&t(fe.find(s=>s.key===r))},children:[n(D,{variant:"flat",color:"chip",size:"xs",endIcon:n(lt,{}),children:n(d,{...e.label})}),n(ee,{children:fe.map(r=>n(T,{value:r.key,children:n(d,{...r.label})},r.key))})]})}function Fo(e){const{download:t,edit:r}=e.entry_permissions;return r?fe.find(s=>s.key==="edit"):t?fe.find(s=>s.key==="download"):fe.find(s=>s.key==="view")}function Co(){return C(e=>Mo(e),{onSuccess:()=>{B(),F(p("Updated user permissions"))},onError:e=>_(e,p("Could not update permissions"))})}function Mo({entryId:e,...t}){return P.put(`file-entries/${e}/change-permissions`,t).then(r=>r.data)}function Lo({className:e,entry:t}){if(!t)return null;const r=t.users;return m("div",{className:N(e,"overflow-hidden"),children:[n("div",{className:"mb-14 text-sm",children:n(d,{message:"Who has access"})}),n(H,{initial:!1,children:r.map(s=>n(Ao,{user:s,entry:t},s.id))})]})}function Ao({user:e,entry:t}){return m(O.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-center text-sm gap-14 mb-20",children:[n("img",{src:e.avatar,className:"rounded-full w-44 h-44 flex-shrink-0",alt:""}),m("div",{children:[n("div",{children:e.display_name}),n("div",{className:"text-muted",children:e.email})]}),n("div",{className:"ml-auto",children:e.owns_entry?n("span",{className:"text-muted",children:n(d,{message:"Owner"})}):n(Ro,{user:e,entry:t})})]},e.id)}function Ro({user:e,entry:t}){const r=Co(),s=nr(),[a,i]=f.exports.useState(()=>Fo(e));return m("div",{className:"flex items-center gap-10",children:[n(xr,{onChange:o=>{r.mutate({userId:e.id,permissions:o.value,entryId:t.id}),i(o)},value:a}),n(R,{onClick:()=>{s.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{F(p("Member removed"))},onError:o=>_(o,p("Could not remove member"))})},children:n(we,{})})]})}function To({className:e,entry:t}){var k;const{trans:r}=j(),{share:s}=je(),a=Do(),[i,o]=f.exports.useState([]),[l,u]=f.exports.useState(!1),[c,g]=f.exports.useState(fe[0]),h=i.every(I=>!I.invalid),[v,y]=f.exports.useState(""),w=ls(cs,{perPage:7,query:v},{enabled:s.suggest_emails}),x=I=>I.description||I.name;return m("div",{className:e,children:[n(xn,{value:i,onChange:o,isAsync:!0,isLoading:w.fetchStatus==="fetching",inputValue:v,onInputValueChange:y,suggestions:(k=w.data)==null?void 0:k.results,displayWith:x,validateWith:I=>{const U=!On(I.description);return{...I,invalid:U,errorMessage:U?r({message:"Not a valid email"}):void 0}},placeholder:r({message:"Enter email addresses"}),label:n(d,{message:"Invite people"}),children:I=>n(T,{value:I.id,startIcon:n(En,{circle:!0,src:I.image,alt:""}),description:I.description,children:I.name})}),m("div",{className:"flex items-center gap-14 justify-between mt-14",children:[n(xr,{onChange:g,value:c}),i.length?n(D,{variant:"flat",color:"primary",size:"sm",disabled:l||!h,onClick:()=>{u(!0),a.mutate({emails:i.map(I=>x(I)),permissions:c.value,entryId:t.id},{onSuccess:()=>{o([])},onSettled:()=>{u(!1)}})},children:n(d,{message:"Share"})}):null]}),n(Lo,{className:"mt-30",entry:t})]})}function wr(e){return be(A.fetchEntryShareableLink(e),()=>_o(e),{enabled:!!e})}function _o(e){return P.get(`file-entries/${e}/shareable-link`).then(t=>t.data)}function $o({entryId:e}){return P.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function zo(){return C(({entryId:e})=>$o({entryId:e}),{onSuccess:(e,{entryId:t})=>{L.setQueryData(A.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>_(e,p("Could not delete link"))})}function Oo({setActivePanel:e,entry:t,focusInput:r}){var u,c;const s=wr(t.id),a=!!((u=s.data)!=null&&u.link),i=tr(),o=zo(),l=s.isLoading||i.isLoading||o.isLoading;return m("div",{children:[n("div",{className:"mb-10",children:n(d,{message:"Share link"})}),m("div",{className:"flex items-center gap-14 justify-between pb-4 px-2",children:[n(mt,{checked:a,disabled:l,onChange:()=>{a?o.mutate({entryId:t.id}):i.mutate({entryId:t.id})},children:a?n(d,{message:"Shareable link is created"}):n(d,{message:"Create shareable link"})}),a&&n(D,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:n(d,{message:"Link settings"})})]}),n(Uo,{autoFocus:r,link:(c=s.data)==null?void 0:c.link})]})}function Uo({link:e,autoFocus:t}){const{base_url:r}=je(),{trans:s}=j(),a=Za(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||ds(),o=`${r}/drive/s/${i}`,[l,u]=jr(o,{successDuration:1e3});return n(We,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":s({message:"Shareable link"}),onFocus:c=>{c.target.select()},endAppend:n(D,{className:"min-w-100",variant:"flat",color:"primary",onClick:u,children:l?n(d,{message:"Copied!"}):n(d,{message:"Copy"})})})}function Bo({entryId:e,...t}){return P.put(`file-entries/${e}/shareable-link`,t).then(r=>r.data)}function Wo(e){return C(t=>Bo(t),{onSuccess:(t,{entryId:r})=>{L.setQueryData(A.fetchEntryShareableLink(r),t)},onError:t=>De(t,e)})}function Ko({className:e,setActivePanel:t,entry:r}){const{formId:s}=te(),{data:a}=wr(r.id),i=a==null?void 0:a.link,o=Ne({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:r.id}}),l=Wo(o);return m(f.exports.Fragment,{children:[n(re,{onDismiss:()=>{t("main")},children:n(d,{message:"Shareable Link Settings"})}),n(G,{children:n(O.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:m(Fe,{id:s,className:e,form:o,onSubmit:u=>{l.mutate(u,{onSuccess:()=>{t("main"),F(p("Link settings saved"))}})},children:[n(Qo,{showField:!!(i!=null&&i.expires_at)}),n(jo,{showField:!!(i!=null&&i.password)}),m(Be,{children:[n(d,{message:"Allow download"}),n(Tt,{name:"allowDownload",children:n(d,{message:"Users with link can download this item"})})]}),m(Be,{showBorder:!1,children:[n(d,{message:"Allow import"}),n(Tt,{name:"allowEdit",children:n(d,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),m(xe,{children:[n(D,{type:"button",onClick:()=>{t("main")},children:n(d,{message:"Cancel"})}),n(D,{type:"submit",form:s,variant:"flat",color:"primary",disabled:l.isLoading,children:n(d,{message:"Save"})})]})]})}const Vo=Hr(qr());function Qo({showField:e}){const{trans:t}=j(),[r,s]=f.exports.useState(e);return m(Be,{children:[n(d,{message:"Link expiration"}),m("div",{children:[n(mt,{checked:r,onChange:a=>{s(a.target.checked)},children:n(d,{message:"Link is valid until"})}),r&&n(us,{min:Vo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function jo({showField:e}){const{trans:t}=j(),[r,s]=f.exports.useState(e);return m(Be,{children:[n(d,{message:"Password protect"}),m("div",{children:[n(mt,{checked:r,onChange:a=>{s(a.target.checked)},children:n(d,{message:"Users will need to enter password in order to view this link"})}),r&&n(Ce,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),placeholder:t({message:"Enter new password..."})})]})]})}function Be({children:e,showBorder:t=!0}){const[r,s]=e;return m("div",{className:N(t&&"border-b mb-20 pb-20"),children:[n("div",{className:"text-sm font-medium mb-8",children:r}),s]})}function jt({entry:e,focusLinkInput:t}){const{data:{fileEntry:r}}=be(A.fetchFileEntry(e.id),()=>P.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),{initialData:{fileEntry:e}}),[s,a]=f.exports.useState("main");return n(ne,{size:"lg",children:n(H,{initial:!1,mode:"wait",children:s==="linkSettings"?n(Ko,{setActivePanel:a,entry:r},"one"):n(Ho,{setActivePanel:a,entry:r,focusLinkInput:t},"two")})})}function Ho({setActivePanel:e,entry:t,focusLinkInput:r}){return m(f.exports.Fragment,{children:[n(re,{children:n(d,{message:"Share \u2018:name\u2019",values:{name:t.name}})}),n(G,{className:"relative",children:m(O.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[n(To,{className:"border-b pb-30 mb-30",entry:t}),n(Oo,{setActivePanel:e,entry:t,focusInput:!!r})]},"share-content")})]})}function qo({allFolders:e,onFolderSelected:t}){const{trans:r}=j(),s=r({message:"Search folders"});return n(Gr,{size:"sm",maxItems:10,placeholder:s,"aria-label":s,className:"pt-20",endAdornmentIcon:n(Ye,{}),items:e,clearInputOnItemSelection:!0,onItemSelected:a=>{const i=parseInt(a),o=e.find(l=>l.id===i);o&&t(o)},children:a=>n(T,{value:a.id,children:a.name},a.id)})}function Go({selectedFolder:e,allFolders:t,rootFolder:r,onFolderSelected:s}){const a=e.path.split("/").map(l=>{const u=parseInt(l);return t.find(c=>u===c.id)}).filter(l=>!!l),i=[r,...a],o=a[a.length-2];return m("div",{className:"flex items-center border-b pb-10 gap-6",children:[n(R,{className:"flex-shrink-0",variant:"outline",size:"xs",radius:"rounded",disabled:!o&&!e.id,onClick:()=>{s(o||r)},children:n($s,{})}),n(ht,{size:"sm",className:"flex-auto",children:i.map(l=>m(Ue,{onSelected:()=>{s(l)},className:"flex items-center gap-8",children:[!l.id&&n(pt,{className:"icon-sm"}),l.name]},l.id||"root"))})]})}const Yo=""+new URL("my-files.88476671.svg",import.meta.url).href;function Zo(e){const{onFolderSelected:t,selectedFolder:r,allFolders:s}=e,a=f.exports.useMemo(()=>{const i=r.id||null;return s.filter(o=>o.parent_id===i)},[r.id,s]);return a.length?n(ms,{className:"h-288 overflow-y-auto",children:a.map(i=>n(ps,{className:"border-b min-h-48",onSelected:()=>{t(i)},startIcon:n(Ee,{type:"folder"}),endIcon:n(Ts,{size:"md"}),children:i.name},i.id))}):n(Ve,{size:"xs",className:"pt-64 pb-20 min-h-288",image:n(Pe,{src:Yo}),title:n(d,{message:'There are no subfolders in ":folder"',values:{folder:r.name}})})}function Xo({entries:e}){const{data:t}=yt(),r=(t==null?void 0:t.folders)||[],s=S(o=>o.activePage),[a,i]=f.exports.useState((s==null?void 0:s.folder)||$.folder);return m(ne,{size:"lg",children:[n(re,{children:n(d,{message:"Move [one \u2018:name\u2018|other :count items]",values:{count:e.length,name:e[0].name}})}),m(G,{children:[n("div",{className:"text-sm",children:n(d,{message:"Select a destination folder."})}),n(qo,{allFolders:r,onFolderSelected:i}),m("div",{className:"mt-40 mb-20",children:[n(Go,{selectedFolder:a,allFolders:r,rootFolder:$.folder,onFolderSelected:i}),n(Zo,{selectedFolder:a,allFolders:r,onFolderSelected:i})]})]}),n(Jo,{selectedFolder:a,setSelectedFolder:i,entries:e})]})}function Jo({selectedFolder:e,setSelectedFolder:t,entries:r}){const{close:s}=te(),a=Ke(),i=jn();return m(xe,{className:"border-t",startAction:m(ce,{type:"modal",onClose:o=>{o&&t(o)},children:[n(D,{startIcon:n(ft,{}),variant:"text",children:n(d,{message:"New Folder"})}),n(yr,{parentId:e.id})]}),children:[!a&&n(D,{variant:"flat",onClick:()=>s(),children:n(d,{message:"Cancel"})}),n(D,{type:"submit",variant:"flat",color:"primary",disabled:!xt(r,e)||i.isLoading,onClick:()=>{i.mutate({destinationId:e.id,entryIds:r.map(o=>o.id)},{onSuccess:s})},children:n(d,{message:"Move here"})})]})}function el(){const e=S(r=>r.activeActionDialog),t=tl(e);return n(ce,{type:"modal",isOpen:!!t,onClose:()=>{b().setActiveActionDialog(null)},children:t})}function tl(e){var t;switch(e==null?void 0:e.name){case"rename":return n(wo,{entries:e.entries});case"newFolder":return n(yr,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return n(Io,{selectedEntry:e.entries[0]});case"share":return n(jt,{entry:e.entries[0]});case"getLink":return n(jt,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return n(Xo,{entries:e.entries});default:return null}}function nl(){const{trans:e}=j(),t=Se(),r=S(o=>o.activePage),[s]=ct(),[a,i]=f.exports.useState(s.get("query")||"");return n("form",{className:"flex-auto max-w-620",onSubmit:o=>{o.preventDefault(),t({pathname:J.path,search:`?query=${a}`},{replace:!0})},children:n(We,{size:"sm",background:"bg-paper",value:a,onChange:o=>i(o.target.value),onFocus:()=>{r!==J&&t(J.path)},startAdornment:n(R,{type:"submit",radius:"rounded",children:n(Ye,{})}),className:"flex-auto max-w-620",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function rl(e){const t=f.exports.useRef(e),r=f.exports.useId();f.exports.useEffect(()=>(_t.set(r,t.current),()=>{_t.delete(r)}),[r])}function sl(){const e=f.exports.useRef(null),[t,r]=f.exports.useState(),[s,a]=f.exports.useState({});rl({type:"fileEntry",onDragStart:(o,l)=>{const u=l;u&&(a({entries:u.getData(),e:o,draggingTreeItem:ti(u.id)}),r({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),r(l=>({...l,end:o}))},onDragEnd:(o,l,u)=>{a({status:u})}});let i=null;return s.entries&&s.e&&(i=n("div",{ref:e,style:s.e?{transform:`translate(${s.e.x}px, ${s.e.y}px)`,width:`${s.e.rect.width}px`}:void 0,className:"fixed isolate left-0 top-0 pointer-events-none",children:s.entries.map((o,l)=>n(al,{index:l,entry:o,points:t,state:s},o.id))})),n(H,{custom:s.status,children:i})}const al=f.exports.memo(({entry:e,points:t,index:r,state:s})=>{var g,h,v,y;const a=S(w=>w.viewMode),i=s.draggingTreeItem?wt(e):e.id,o=kn.get(i);if(!(o!=null&&o.rect)||!(t!=null&&t.start))return null;const l=o.rect,u=((g=s.entries)==null?void 0:g.length)||0,c=w=>{var x,k,I;return w==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((x=t.end)==null?void 0:x.x)||0),y:l.top-(((k=t.end)==null?void 0:k.y)||0),width:`${(I=s.e)==null?void 0:I.rect.width}px`}};return m(O.div,{transition:{delay:.01*r,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(h=s.e)==null?void 0:h.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:c,style:{width:a==="grid"?`${(v=s.e)==null?void 0:v.rect.width}px`:void 0,height:`${(y=s.e)==null?void 0:y.rect.height}px`},className:N("absolute bg-paper whitespace-nowrap rounded border border-primary-light max-h-48",r<2&&"shadow",r===0&&"z-10 top-0 left-0",r>0&&"top-6 left-6"),children:[u>1&&r===0&&n(il,{count:u}),m("div",{className:"text-sm h-full flex justify-center items-center px-16 gap-10 bg-primary-light/20 overflow-hidden",children:[n(Ee,{type:e.type}),n("div",{className:"flex-auto text-ellipsis overflow-hidden",children:e.name})]})]},e.id)}),il=f.exports.memo(({count:e})=>n(O.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -top-6 shadow-lg -right-6 z-30 rounded-full bg-danger text-white w-20 h-20 flex items-center justify-center text-sm font-bold z-10",children:e},"entryCount"));function ol(){const{isMobileMode:e}=f.exports.useContext(Y),t=S(r=>r.activePage);return m(Rn,{className:"px-8 md:px-26 py-4 flex items-center gap-20 border-b h-60",children:[e?n(hr,{isDisabled:t==null?void 0:t.disableSort}):n(gr,{}),m("div",{className:"text-muted ml-auto flex-shrink-0",children:[n(ll,{}),n(cl,{})]})]})}function ll(){const e=S(r=>r.viewMode);return n(ge,{label:e==="grid"?n(d,{message:"List view"}):n(d,{message:"Grid view"}),children:n(R,{size:"md",onClick:()=>{b().setViewMode(b().viewMode==="list"?"grid":"list")},children:e==="list"?n(Ms,{}):n(Ls,{})})})}function cl(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=f.exports.useContext(Y);return n(ge,{label:e?n(d,{message:"Hide details"}):n(d,{message:"Show details"}),children:n(R,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:n(As,{})})})}function ie(){const{pathname:e}=nn(),{hash:t}=st(),{workspaceId:r}=q(),s=S(i=>i.activePage);f.exports.useEffect(()=>{b().setActivePage(qa.find(i=>i.path===e)||Kn(t))},[e,t]);const a=f.exports.useMemo(()=>({workspaceId:r}),[r]);return f.exports.useEffect(()=>()=>{b().reset()},[]),m(f.exports.Fragment,{children:[(s==null?void 0:s.label)&&n(Yr,{children:s.label}),m(vn,{children:[n(yn.Provider,{value:a,children:m(hn,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[n(dl,{}),n($t,{position:"left",size:"md",children:n(ui,{})}),n(ol,{}),n(bn,{children:n(ao,{})}),n(uo,{}),n(el,{}),n($t,{position:"right",size:"lg",children:n(ho,{})})]})}),n(sl,{})]})]})}function dl(){const{isMobileMode:e}=f.exports.useContext(Y),t=S(i=>i.activePage),r=e?null:n(nl,{}),s=n(R,{elementType:cn,to:J.path,children:n(Ye,{})}),a=m(f.exports.Fragment,{children:[t!==J&&s,n(Xn,{isCompact:!0})]});return m(f.exports.Fragment,{children:[n(gn,{rightChildren:e&&a,menuPosition:"drive-navbar",children:r}),e&&n(ul,{})]})}function ul(){const e=S(t=>t.selectedEntries.size);return e?m("div",{className:"fixed bg-primary w-full h-54 text-on-primary shadow-xl z-10 rounded top-0 right-0 flex items-center justify-center gap-10 px-6",children:[n(R,{onClick:()=>{b().selectEntries([])},children:n(we,{})}),n(d,{message:":count selected",values:{count:e}}),n(ur,{className:"ml-auto"})]}):null}const ml=[{path:"/",element:n(ae,{children:n(ie,{})})},{path:"/folders/:hash",element:n(ae,{children:n(ie,{})})},{path:"/shares",element:n(ae,{children:n(ie,{})})},{path:"/recent",element:n(ae,{children:n(ie,{})})},{path:"/starred",element:n(ae,{children:n(ie,{})})},{path:"/trash",element:n(ae,{children:n(ie,{})})},{path:"/search",element:n(ae,{children:n(ie,{})})},{path:"s/:hash",element:n(sa,{})},{path:"*",element:n(rn,{})}];function yl(){return Zr(ml)}export{yl as default};
//# sourceMappingURL=drive-routes.3ff65938.js.map
